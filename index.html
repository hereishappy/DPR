<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Supervision Data Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card-transition {
            transition: all 0.3s ease-in-out;
        }
        .hidden-card {
            transform: translateX(100%);
            opacity: 0;
        }
        .visible-card {
            transform: translateX(0);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 to-indigo-800 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-white mb-2">Scaffolding Supervision</h1>
            <p class="text-blue-200">Data Collection System</p>
        </div>

        <!-- Login Card -->
        <div id="loginCard" class="bg-white rounded-xl shadow-2xl p-6 mb-4 card-transition visible-card">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-800">Supervisor Login</h2>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Supervisor</label>
                    <select id="supervisorSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Choose Supervisor</option>
                        <option value="MAHENDRA KUMAR">MAHENDRA KUMAR</option>
                        <option value="PINTU SAH">PINTU SAH</option>
                        <option value="HARKIRAT SINGH">HARKIRAT SINGH</option>
                        <option value="SUNIL CHAUHAN">SUNIL CHAUHAN</option>
                        <option value="NSUP1">NSUP1</option>
                        <option value="NSUP2">NSUP2</option>
                        <option value="NSUP3">NSUP3</option>
                        <option value="NSUP4">NSUP4</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Enter PIN</label>
                    <input type="password" id="pinInput" placeholder="e.g., MAHE13" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    Login
                </button>
            </div>
        </div>

        <!-- Attendance Card -->
        <div id="attendanceCard" class="bg-white rounded-xl shadow-2xl p-6 mb-4 card-transition hidden-card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Attendance Entry</h2>
                <span id="supervisorName" class="text-sm bg-blue-100 text-blue-800 px-3 py-1 rounded-full"></span>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Worker Name</label>
                    <input type="text" id="workerNameInput" placeholder="Enter worker name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <button onclick="addWorker()" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                    Add Worker
                </button>

                <div id="workersList" class="space-y-2 max-h-40 overflow-y-auto"></div>

                <button onclick="submitAttendance()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors" disabled id="submitAttendanceBtn">
                    Submit Attendance
                </button>
            </div>
        </div>

        <!-- Data Entry Card -->
        <div id="dataEntryCard" class="bg-white rounded-xl shadow-2xl p-6 mb-4 card-transition hidden-card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Work Data Entry</h2>
                <button onclick="logout()" class="text-sm bg-red-100 text-red-800 px-3 py-1 rounded-full hover:bg-red-200">Logout</button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Work Type</label>
                    <select id="workTypeSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Work Type</option>
                        <option value="ERECTION">ERECTION</option>
                        <option value="DISMANTLING">DISMANTLING</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Length</label>
                        <input type="number" id="lengthInput" placeholder="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Width</label>
                        <input type="number" id="widthInput" placeholder="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Height</label>
                        <input type="number" id="heightInput" placeholder="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
                        <input type="number" id="quantityInput" placeholder="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <div class="bg-gray-50 p-3 rounded-lg">
                    <p class="text-sm text-gray-600">Volume: <span id="volumeDisplay" class="font-semibold">0</span></p>
                </div>

                <button onclick="addWorkEntry()" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                    Add Entry
                </button>

                <div id="workEntriesList" class="space-y-2 max-h-40 overflow-y-auto"></div>

                <button onclick="proceedToOvertime()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors" disabled id="proceedOvertimeBtn">
                    Proceed to Overtime
                </button>
            </div>
        </div>

        <!-- Overtime Card -->
        <div id="overtimeCard" class="bg-white rounded-xl shadow-2xl p-6 mb-4 card-transition hidden-card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Overtime Entry</h2>
            </div>

            <div class="space-y-4">
                <div id="overtimeWorkersList" class="space-y-3 max-h-60 overflow-y-auto"></div>

                <button onclick="proceedToProductivity()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    Proceed to Productivity
                </button>
            </div>
        </div>

        <!-- Productivity Card -->
        <div id="productivityCard" class="bg-white rounded-xl shadow-2xl p-6 mb-4 card-transition hidden-card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Productivity Report</h2>
            </div>

            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                    <p class="text-sm"><span class="font-medium">Supervisor:</span> <span id="finalSupervisorName"></span></p>
                    <p class="text-sm"><span class="font-medium">Total Erection:</span> <span id="totalErection">0</span></p>
                    <p class="text-sm"><span class="font-medium">Total Dismantling:</span> <span id="totalDismantling">0</span></p>
                    <p class="text-sm"><span class="font-medium">Total Manhours:</span> <span id="totalManhours">0</span></p>
                    <p class="text-lg font-semibold text-blue-600"><span class="font-medium">Productivity:</span> <span id="productivityValue">0</span></p>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="shareReport()" class="bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                        Share Report
                    </button>
                    <button onclick="resetApp()" class="bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentSupervisor = '';
        let workers = [];
        let workEntries = [];
        let overtimeData = {};
        let totals = {
            erection: 0,
            dismantling: 0,
            manhours: 0
        };

        // PIN mapping
        const pinMap = {
            'MAHENDRA KUMAR': 'MAHE13',
            'PINTU SAH': 'PINT13',
            'HARKIRAT SINGH': 'HARK13',
            'SUNIL CHAUHAN': 'SUNI13',
            'NSUP1': 'NSUP13',
            'NSUP2': 'NSU213',
            'NSUP3': 'NSU313',
            'NSUP4': 'NSU413'
        };

        // Login function
        function login() {
            const supervisor = document.getElementById('supervisorSelect').value;
            const pin = document.getElementById('pinInput').value.toUpperCase();

            if (!supervisor) {
                alert('Please select a supervisor');
                return;
            }

            if (pinMap[supervisor] !== pin) {
                alert('Invalid PIN');
                return;
            }

            currentSupervisor = supervisor;
            document.getElementById('supervisorName').textContent = supervisor;
            document.getElementById('finalSupervisorName').textContent = supervisor;
            
            showCard('attendanceCard');
        }

        // Show card function
        function showCard(cardId) {
            const cards = ['loginCard', 'attendanceCard', 'dataEntryCard', 'overtimeCard', 'productivityCard'];
            
            cards.forEach(id => {
                const card = document.getElementById(id);
                if (id === cardId) {
                    card.classList.remove('hidden', 'hidden-card');
                    card.classList.add('visible-card');
                } else {
                    card.classList.add('hidden-card');
                    card.classList.remove('visible-card');
                    setTimeout(() => card.classList.add('hidden'), 300);
                }
            });
        }

        // Add worker function
        function addWorker() {
            const workerName = document.getElementById('workerNameInput').value.trim();
            
            if (!workerName) {
                alert('Please enter worker name');
                return;
            }

            if (workers.includes(workerName)) {
                alert('Worker already added');
                return;
            }

            workers.push(workerName);
            updateWorkersList();
            document.getElementById('workerNameInput').value = '';
            document.getElementById('workerNameInput').focus();
            
            document.getElementById('submitAttendanceBtn').disabled = false;
        }

        // Update workers list
        function updateWorkersList() {
            const list = document.getElementById('workersList');
            list.innerHTML = workers.map(worker => 
                `<div class="bg-green-50 p-2 rounded border-l-4 border-green-500">
                    <span class="text-sm font-medium">${worker}</span>
                </div>`
            ).join('');
        }

        // Submit attendance
        function submitAttendance() {
            if (workers.length === 0) {
                alert('Please add at least one worker');
                return;
            }

            // Initialize overtime data
            workers.forEach(worker => {
                overtimeData[worker] = 0;
            });

            showCard('dataEntryCard');
        }

        // Calculate volume
        function calculateVolume() {
            const length = parseFloat(document.getElementById('lengthInput').value) || 0;
            const width = parseFloat(document.getElementById('widthInput').value) || 0;
            const height = parseFloat(document.getElementById('heightInput').value) || 0;
            const quantity = parseFloat(document.getElementById('quantityInput').value) || 0;
            
            const volume = length * width * height * quantity;
            document.getElementById('volumeDisplay').textContent = volume;
            return volume;
        }

        // Add event listeners for volume calculation
        ['lengthInput', 'widthInput', 'heightInput', 'quantityInput'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateVolume);
        });

        // Add work entry
        function addWorkEntry() {
            const workType = document.getElementById('workTypeSelect').value;
            const length = parseFloat(document.getElementById('lengthInput').value) || 0;
            const width = parseFloat(document.getElementById('widthInput').value) || 0;
            const height = parseFloat(document.getElementById('heightInput').value) || 0;
            const quantity = parseFloat(document.getElementById('quantityInput').value) || 0;

            if (!workType || !length || !width || !height || !quantity) {
                alert('Please fill all fields');
                return;
            }

            const volume = length * width * height * quantity;
            
            const entry = {
                workType,
                length,
                width,
                height,
                quantity,
                volume
            };

            workEntries.push(entry);
            updateWorkEntriesList();
            
            // Clear inputs
            document.getElementById('workTypeSelect').value = '';
            document.getElementById('lengthInput').value = '';
            document.getElementById('widthInput').value = '';
            document.getElementById('heightInput').value = '';
            document.getElementById('quantityInput').value = '';
            document.getElementById('volumeDisplay').textContent = '0';
            
            document.getElementById('proceedOvertimeBtn').disabled = false;
        }

        // Update work entries list
        function updateWorkEntriesList() {
            const list = document.getElementById('workEntriesList');
            list.innerHTML = workEntries.map((entry, index) => 
                `<div class="bg-blue-50 p-2 rounded border-l-4 border-blue-500">
                    <div class="text-xs text-gray-600">${entry.workType}</div>
                    <div class="text-sm font-medium">${entry.length}×${entry.width}×${entry.height} × ${entry.quantity} = ${entry.volume}</div>
                </div>`
            ).join('');
        }

        // Proceed to overtime
        function proceedToOvertime() {
            if (workEntries.length === 0) {
                alert('Please add at least one work entry');
                return;
            }

            updateOvertimeWorkersList();
            showCard('overtimeCard');
        }

        // Update overtime workers list
        function updateOvertimeWorkersList() {
            const list = document.getElementById('overtimeWorkersList');
            list.innerHTML = workers.map(worker => 
                `<div class="bg-gray-50 p-3 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">${worker}</span>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600">OT Hours:</span>
                            <input type="number" value="${overtimeData[worker]}" 
                                   onchange="updateOvertime('${worker}', this.value)"
                                   class="w-16 p-1 border border-gray-300 rounded text-center">
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mt-1">
                        Total Hours: <span id="total-${worker}">${8 + overtimeData[worker]}</span>
                    </div>
                </div>`
            ).join('');
        }

        // Update overtime
        function updateOvertime(worker, hours) {
            overtimeData[worker] = parseFloat(hours) || 0;
            document.getElementById(`total-${worker}`).textContent = 8 + overtimeData[worker];
        }

        // Proceed to productivity
        function proceedToProductivity() {
            calculateTotals();
            updateProductivityDisplay();
            showCard('productivityCard');
        }

        // Calculate totals
        function calculateTotals() {
            totals.erection = workEntries
                .filter(entry => entry.workType === 'ERECTION')
                .reduce((sum, entry) => sum + entry.volume, 0);
            
            totals.dismantling = workEntries
                .filter(entry => entry.workType === 'DISMANTLING')
                .reduce((sum, entry) => sum + entry.volume, 0);
            
            totals.manhours = workers.reduce((sum, worker) => sum + (8 + overtimeData[worker]), 0);
        }

        // Update productivity display
        function updateProductivityDisplay() {
            document.getElementById('totalErection').textContent = totals.erection;
            document.getElementById('totalDismantling').textContent = totals.dismantling;
            document.getElementById('totalManhours').textContent = totals.manhours;
            
            const productivity = totals.manhours > 0 ? 
                ((totals.erection + (totals.dismantling / 2)) / totals.manhours).toFixed(2) : 0;
            document.getElementById('productivityValue').textContent = productivity;
        }

        // Share report
        function shareReport() {
            const productivity = document.getElementById('productivityValue').textContent;
            const totalVolume = totals.erection + totals.dismantling;
            
            let report = `*Scaffolding Daily Report*\n\n`;
            report += `Supervisor: ${currentSupervisor}\n`;
            report += `Total Volume: ${totalVolume}\n`;
            report += `Productivity: ${productivity}\n\n`;
            report += `*Workers & Overtime:*\n`;
            
            workers.forEach(worker => {
                report += `${worker}: ${overtimeData[worker]} OT hours\n`;
            });
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(report)}`;
            window.open(whatsappUrl, '_blank');
            
            // Send to Google Sheets
            sendToGoogleSheets();
        }

        // Send to Google Sheets
        function sendToGoogleSheets() {
            const today = new Date().toISOString().split('T')[0];
            
            // Prepare DPR data
            const dprData = workEntries.map(entry => ({
                date: today,
                supervisor: currentSupervisor,
                workType: entry.workType,
                length: entry.length,
                width: entry.width,
                height: entry.height,
                quantity: entry.quantity,
                volume: entry.volume,
                dismantling: entry.workType === 'DISMANTLING' ? entry.volume : '',
                erection: entry.workType === 'ERECTION' ? entry.volume : ''
            }));
            
            // Prepare Manpower data
            const manpowerData = workers.map(worker => ({
                date: today,
                supervisor: currentSupervisor,
                empName: worker,
                otHours: overtimeData[worker],
                totalManhours: 8 + overtimeData[worker]
            }));
            
            // Here you would call your Google Apps Script Web App
            // Replace 'YOUR_WEBAPP_URL' with your actual deployed web app URL
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbwC3lKBAV8SxWMzaiLA6UlqAHqRg8qmUGoQFPr8idbWwtY9B7GwzTTQDviMCY_PPXm4ug/exec';
            
            fetch(webAppUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dprData: dprData,
                    manpowerData: manpowerData
                })
            }).catch(error => {
                console.log('Google Sheets integration pending deployment');
            });
        }

        // Reset app
        function resetApp() {
            if (confirm('Are you sure you want to reset all data?')) {
                currentSupervisor = '';
                workers = [];
                workEntries = [];
                overtimeData = {};
                totals = { erection: 0, dismantling: 0, manhours: 0 };
                
                // Clear all inputs
                document.getElementById('supervisorSelect').value = '';
                document.getElementById('pinInput').value = '';
                document.getElementById('workerNameInput').value = '';
                
                showCard('loginCard');
            }
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                showCard('dataEntryCard');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96622fb6f7413b46',t:'MTc1MzY4Mjc0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
