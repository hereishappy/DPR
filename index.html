<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Data Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card { 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        .btn { 
            padding: 16px 24px; 
            border-radius: 12px; 
            font-weight: 600; 
            font-size: 16px;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-blue { background: #3b82f6; color: white; }
        .btn-blue:hover { background: #2563eb; transform: translateY(-1px); }
        .btn-green { background: #10b981; color: white; }
        .btn-green:hover { background: #059669; transform: translateY(-1px); }
        .btn-gray { background: #6b7280; color: white; }
        .btn-gray:hover { background: #4b5563; }
        .btn-red { background: #ef4444; color: white; }
        .btn-red:hover { background: #dc2626; }
        .input { 
            padding: 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 12px; 
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }
        .input:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 8px;
            font-weight: 600;
            font-size: 18px;
        }
        .step.active { background: #3b82f6; color: white; }
        .step.completed { background: #10b981; color: white; }
        .step.inactive { background: #e5e7eb; color: #6b7280; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">📋 Daily Report</h1>
            <p class="text-gray-600 text-lg">Scaffolding Work Tracker</p>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div id="step1" class="step active">1</div>
            <div id="step2" class="step inactive">2</div>
            <div id="step3" class="step inactive">3</div>
        </div>

        <!-- Card 1: Basic Info -->
        <div id="card1" class="card p-8 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
                👷 Basic Information
            </h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-3">📅 Date</label>
                    <input type="date" id="workDate" class="input">
                </div>
                
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-3">👤 Supervisor Name</label>
                    <input type="text" id="supervisorName" placeholder="Enter your name" class="input">
                </div>
                
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-3">📍 Work Area</label>
                    <input type="text" id="workArea" placeholder="Enter work location" class="input">
                </div>
                
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-3">👥 Number of Workers</label>
                    <input type="number" id="manpower" placeholder="How many workers?" class="input" oninput="updateSummary()">
                </div>
                
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-3">⏰ Overtime Hours</label>
                    <input type="number" id="overtimeHours" placeholder="Extra hours worked" class="input" oninput="updateSummary()">
                </div>
                
                <!-- Summary Display -->
                <div id="workSummary" class="bg-blue-50 p-6 rounded-xl border-2 border-blue-200">
                    <p class="text-lg font-bold text-blue-900 mb-2">📊 Today's Summary</p>
                    <p id="summaryText" class="text-blue-800 text-lg">Enter workers and overtime to see summary</p>
                    <p id="targetText" class="text-green-700 font-bold text-xl mt-2"></p>
                </div>
            </div>
            
            <button onclick="proceedToWorkEntry()" class="btn btn-blue w-full mt-8 text-xl">
                Next Step →
            </button>
        </div>

        <!-- Card 2: Work Entry -->
        <div id="card2" class="card p-8 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
                🔧 Add Work Entry
            </h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-4">Choose Work Type:</label>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="setWorkType('erection')" id="erectionBtn" class="p-6 border-3 border-gray-300 rounded-xl text-center hover:border-blue-500 hover:bg-blue-50 transition-all">
                            <div class="text-4xl mb-2">🏗️</div>
                            <div class="text-lg font-bold">Building Up</div>
                        </button>
                        <button onclick="setWorkType('dismantling')" id="dismantlingBtn" class="p-6 border-3 border-gray-300 rounded-xl text-center hover:border-red-500 hover:bg-red-50 transition-all">
                            <div class="text-4xl mb-2">🔨</div>
                            <div class="text-lg font-bold">Taking Down</div>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-3">📏 Length</label>
                        <input type="number" id="length" step="0.1" placeholder="0.0" class="input text-center text-xl" oninput="calculateVolume()">
                        <p class="text-center text-gray-600 mt-1">meters</p>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-3">📐 Width</label>
                        <input type="number" id="width" step="0.1" placeholder="0.0" class="input text-center text-xl" oninput="calculateVolume()">
                        <p class="text-center text-gray-600 mt-1">meters</p>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-3">📊 Height</label>
                        <input type="number" id="height" step="0.1" placeholder="0.0" class="input text-center text-xl" oninput="calculateVolume()">
                        <p class="text-center text-gray-600 mt-1">meters</p>
                    </div>
                </div>
                
                <div>
                    <label class="block text-lg font-semibold text-gray-800 mb-3">🔢 How Many?</label>
                    <input type="number" id="quantity" placeholder="Enter quantity" class="input text-center text-xl" oninput="calculateVolume()">
                </div>
                
                <div class="bg-green-50 p-6 rounded-xl border-2 border-green-200 text-center">
                    <p class="text-lg text-green-800 mb-2">📦 Total Volume:</p>
                    <p id="calculatedVolume" class="text-3xl font-bold text-green-900">0.00 m³</p>
                </div>
                
                <button onclick="addEntry()" class="btn btn-green w-full text-xl">
                    ✅ Add This Entry
                </button>
            </div>
            
            <!-- Entries List -->
            <div id="entriesList" class="mt-8"></div>
            
            <div class="flex gap-4 mt-8">
                <button onclick="showCard(1)" class="btn btn-gray flex-1 text-lg">
                    ← Back
                </button>
                <button onclick="generateReport()" class="btn btn-blue flex-1 text-lg">
                    View Report →
                </button>
            </div>
        </div>

        <!-- Card 3: Report -->
        <div id="card3" class="card p-8 mb-6 hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
                📊 Daily Report
            </h2>
            
            <div id="reportContent" class="space-y-6"></div>
            
            <div class="grid grid-cols-1 gap-4 mt-8">
                <button onclick="shareReport()" class="btn btn-green w-full text-lg">
                    📤 Share Report
                </button>
                <button onclick="downloadReport()" class="btn btn-blue w-full text-lg">
                    📄 Download Text Report
                </button>
                <button onclick="showCard(2)" class="btn btn-gray w-full text-lg">
                    ← Add More Work
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentWorkType = '';
        let entries = [];
        let dailyData = {};

        // Set today's date by default
        document.getElementById('workDate').valueAsDate = new Date();

        function updateSummary() {
            const manpower = parseInt(document.getElementById('manpower').value) || 0;
            const overtime = parseInt(document.getElementById('overtimeHours').value) || 0;
            
            if (manpower > 0) {
                const regularHours = manpower * 8;
                const totalHours = regularHours + overtime;
                const target = manpower * 8 * 2.8; // 8 workers * 8 hours * 2.8 = target cubic meters
                
                document.getElementById('summaryText').textContent = `${manpower} workers × 8h + ${overtime}h overtime = ${totalHours} total hours`;
                document.getElementById('targetText').textContent = `Daily Target: ${target.toFixed(1)} m³`;
            } else {
                document.getElementById('summaryText').textContent = 'Enter manpower and overtime to see summary';
                document.getElementById('targetText').textContent = '';
            }
        }

        function proceedToWorkEntry() {
            const supervisorName = document.getElementById('supervisorName').value;
            const workArea = document.getElementById('workArea').value;
            const manpower = document.getElementById('manpower').value;
            
            if (!supervisorName || !workArea || !manpower) {
                alert('Please fill in all required fields');
                return;
            }
            
            dailyData = {
                date: document.getElementById('workDate').value,
                supervisor: supervisorName,
                area: workArea,
                manpower: parseInt(manpower),
                overtime: parseInt(document.getElementById('overtimeHours').value) || 0
            };
            
            showCard(2);
        }

        function showCard(cardNumber) {
            document.getElementById('card1').classList.add('hidden');
            document.getElementById('card2').classList.add('hidden');
            document.getElementById('card3').classList.add('hidden');
            document.getElementById(`card${cardNumber}`).classList.remove('hidden');
            
            // Update step indicators
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed', 'inactive');
                
                if (i < cardNumber) {
                    step.classList.add('completed');
                } else if (i === cardNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.add('inactive');
                }
            }
        }

        function setWorkType(type) {
            currentWorkType = type;
            document.getElementById('erectionBtn').classList.remove('border-blue-500', 'bg-blue-50', 'border-red-500', 'bg-red-50');
            document.getElementById('dismantlingBtn').classList.remove('border-blue-500', 'bg-blue-50', 'border-red-500', 'bg-red-50');
            
            if (type === 'erection') {
                document.getElementById('erectionBtn').classList.add('border-blue-500', 'bg-blue-50');
            } else {
                document.getElementById('dismantlingBtn').classList.add('border-red-500', 'bg-red-50');
            }
        }

        function calculateVolume() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            
            const volume = length * width * height * quantity;
            document.getElementById('calculatedVolume').textContent = `${volume.toFixed(2)} m³`;
        }

        function addEntry() {
            if (!currentWorkType) {
                alert('Please select work type (Erection or Dismantling)');
                return;
            }
            
            const length = parseFloat(document.getElementById('length').value);
            const width = parseFloat(document.getElementById('width').value);
            const height = parseFloat(document.getElementById('height').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            
            if (!length || !width || !height || !quantity) {
                alert('Please fill in all dimensions and quantity');
                return;
            }
            
            const volume = length * width * height * quantity;
            
            entries.push({
                type: currentWorkType,
                length,
                width,
                height,
                quantity,
                volume
            });
            
            updateEntriesList();
            clearEntryForm();
        }

        function updateEntriesList() {
            const entriesList = document.getElementById('entriesList');
            
            if (entries.length === 0) {
                entriesList.innerHTML = '';
                return;
            }
            
            let html = '<div class="border-t-4 border-gray-200 pt-6"><h3 class="text-xl font-bold text-gray-900 mb-4 text-center">📝 Work Entries Added:</h3>';
            
            entries.forEach((entry, index) => {
                const typeColor = entry.type === 'erection' ? 'bg-blue-100 border-blue-300' : 'bg-red-100 border-red-300';
                const typeIcon = entry.type === 'erection' ? '🏗️' : '🔨';
                const typeName = entry.type === 'erection' ? 'Building Up' : 'Taking Down';
                
                html += `
                    <div class="${typeColor} p-4 rounded-xl mb-3 border-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <span class="text-2xl">${typeIcon}</span>
                                    <span class="font-bold text-lg text-gray-900">${typeName}</span>
                                </div>
                                <div class="text-gray-700 text-lg">
                                    ${entry.length} × ${entry.width} × ${entry.height} × ${entry.quantity}
                                </div>
                                <div class="font-bold text-xl text-gray-900 mt-1">
                                    = ${entry.volume.toFixed(2)} m³
                                </div>
                            </div>
                            <button onclick="removeEntry(${index})" class="btn btn-red text-lg px-3 py-1">
                                ✕
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            entriesList.innerHTML = html;
        }

        function removeEntry(index) {
            entries.splice(index, 1);
            updateEntriesList();
        }

        function clearEntryForm() {
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('calculatedVolume').textContent = '0.00 m³';
            currentWorkType = '';
            document.getElementById('erectionBtn').classList.remove('border-blue-500', 'bg-blue-50');
            document.getElementById('dismantlingBtn').classList.remove('border-red-500', 'bg-red-50');
        }

        function generateReport() {
            if (entries.length === 0) {
                alert('Please add at least one work entry');
                return;
            }
            
            const totalErection = entries.filter(e => e.type === 'erection').reduce((sum, e) => sum + e.volume, 0);
            const totalDismantling = entries.filter(e => e.type === 'dismantling').reduce((sum, e) => sum + e.volume, 0);
            const totalManHours = (dailyData.manpower * 8) + dailyData.overtime;
            const productivity = (totalErection + (totalDismantling / 2)) / totalManHours;
            const target = dailyData.manpower * 8 * 2.8;
            const achievement = ((totalErection + totalDismantling) / target * 100);
            
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div id="reportCard" class="bg-gradient-to-br from-blue-50 to-green-50 p-8 rounded-xl border-2 border-blue-200" style="background: linear-gradient(135deg, #dbeafe 0%, #ecfdf5 100%);">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">📊 DAILY SCAFFOLDING REPORT</h3>
                        <div class="w-16 h-1 bg-blue-500 mx-auto rounded"></div>
                    </div>
                    
                    <!-- Work Summary Section -->
                    <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">👷</span> Work Summary
                        </h4>
                        <div class="grid grid-cols-2 gap-4 text-base">
                            <div><span class="font-semibold text-gray-700">📅 Date:</span><br><span class="text-gray-900">${dailyData.date}</span></div>
                            <div><span class="font-semibold text-gray-700">👤 Supervisor:</span><br><span class="text-gray-900">${dailyData.supervisor}</span></div>
                            <div><span class="font-semibold text-gray-700">📍 Area:</span><br><span class="text-gray-900">${dailyData.area}</span></div>
                            <div><span class="font-semibold text-gray-700">👥 Workers:</span><br><span class="text-gray-900">${dailyData.manpower}</span></div>
                            <div><span class="font-semibold text-gray-700">⏰ Total Hours:</span><br><span class="text-gray-900">${totalManHours}h</span></div>
                            <div><span class="font-semibold text-gray-700">🎯 Target:</span><br><span class="text-gray-900 font-bold">${target.toFixed(1)} m³</span></div>
                        </div>
                    </div>
                    
                    <!-- Performance Results -->
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-2xl mr-2">📈</span> Performance Results
                        </h4>
                        <div class="grid grid-cols-3 gap-4 text-center mb-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600">${totalErection.toFixed(1)}</div>
                                <div class="text-sm text-gray-700">🏗️ Building Up (m³)</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg">
                                <div class="text-2xl font-bold text-red-600">${totalDismantling.toFixed(1)}</div>
                                <div class="text-sm text-gray-700">🔨 Taking Down (m³)</div>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="text-2xl font-bold text-gray-900">${(totalErection + totalDismantling).toFixed(1)}</div>
                                <div class="text-sm text-gray-700">📦 Total Work (m³)</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="bg-${achievement >= 100 ? 'green' : 'orange'}-50 p-4 rounded-lg">
                                <div class="text-xl font-bold text-${achievement >= 100 ? 'green' : 'orange'}-600">${achievement.toFixed(1)}%</div>
                                <div class="text-sm text-gray-700">📊 Achievement</div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="text-xl font-bold text-green-600">${productivity.toFixed(2)}</div>
                                <div class="text-sm text-gray-700">⚡ Productivity (m³/h)</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            showCard(3);
            
            // Auto-download JPEG after a short delay
            setTimeout(() => {
                downloadReportAsJPEG();
            }, 500);
        }

        function downloadReportAsJPEG() {
            const reportCard = document.getElementById('reportCard');
            
            // Use html2canvas library
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
            script.onload = function() {
                html2canvas(reportCard, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    width: reportCard.offsetWidth,
                    height: reportCard.offsetHeight
                }).then(canvas => {
                    // Convert canvas to JPEG
                    const link = document.createElement('a');
                    link.download = `Scaffolding_Report_${dailyData.date}_${dailyData.supervisor.replace(/\s+/g, '_')}.jpg`;
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.click();
                });
            };
            document.head.appendChild(script);
        }

        function downloadReport() {
            const totalErection = entries.filter(e => e.type === 'erection').reduce((sum, e) => sum + e.volume, 0);
            const totalDismantling = entries.filter(e => e.type === 'dismantling').reduce((sum, e) => sum + e.volume, 0);
            const totalManHours = (dailyData.manpower * 8) + dailyData.overtime;
            const productivity = (totalErection + (totalDismantling / 2)) / totalManHours;
            const target = dailyData.manpower * 8 * 2.8;
            const achievement = ((totalErection + totalDismantling) / target * 100);
            
            let reportText = `SCAFFOLDING DAILY REPORT\n`;
            reportText += `========================\n\n`;
            reportText += `Date: ${dailyData.date}\n`;
            reportText += `Supervisor: ${dailyData.supervisor}\n`;
            reportText += `Work Area: ${dailyData.area}\n`;
            reportText += `Workers: ${dailyData.manpower}\n`;
            reportText += `Overtime Hours: ${dailyData.overtime}h\n`;
            reportText += `Total Man Hours: ${totalManHours}h\n`;
            reportText += `Daily Target: ${target.toFixed(1)} m³\n\n`;
            
            reportText += `PERFORMANCE SUMMARY\n`;
            reportText += `==================\n`;
            reportText += `Erection Work: ${totalErection.toFixed(2)} m³\n`;
            reportText += `Dismantling Work: ${totalDismantling.toFixed(2)} m³\n`;
            reportText += `Total Work: ${(totalErection + totalDismantling).toFixed(2)} m³\n`;
            reportText += `Productivity: ${productivity.toFixed(2)} m³/hour\n`;
            reportText += `Target Achievement: ${achievement.toFixed(1)}%\n\n`;
            
            reportText += `WORK ENTRIES\n`;
            reportText += `============\n`;
            entries.forEach((entry, index) => {
                reportText += `${index + 1}. ${entry.type.toUpperCase()}: ${entry.length}×${entry.width}×${entry.height} × ${entry.quantity} = ${entry.volume.toFixed(2)} m³\n`;
            });
            
            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Scaffolding_Report_${dailyData.date}_${dailyData.supervisor.replace(/\s+/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function shareReport() {
            const totalErection = entries.filter(e => e.type === 'erection').reduce((sum, e) => sum + e.volume, 0);
            const totalDismantling = entries.filter(e => e.type === 'dismantling').reduce((sum, e) => sum + e.volume, 0);
            const target = dailyData.manpower * 8 * 2.8;
            const achievement = ((totalErection + totalDismantling) / target * 100);
            
            const shareText = `🏗️ SCAFFOLDING DAILY REPORT\n\n` +
                `📅 Date: ${dailyData.date}\n` +
                `👷 Supervisor: ${dailyData.supervisor}\n` +
                `📍 Area: ${dailyData.area}\n` +
                `👥 Workers: ${dailyData.manpower}\n` +
                `🎯 Target: ${target.toFixed(1)} m³\n` +
                `📊 Achievement: ${achievement.toFixed(1)}%\n\n` +
                `📈 WORK COMPLETED:\n` +
                `🏗️ Erection: ${totalErection.toFixed(2)} m³\n` +
                `🔨 Dismantling: ${totalDismantling.toFixed(2)} m³\n` +
                `📦 Total: ${(totalErection + totalDismantling).toFixed(2)} m³`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Scaffolding Daily Report',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Report copied to clipboard! You can now paste it in any messaging app.');
                });
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9640fab6f0477f10',t:'MTc1MzMzNDU0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
