<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guardians of Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.js.org/dist/html2canvas.min.js"></script>
    <style>
        .card-transition {
            transition: all 0.3s ease-in-out;
        }
        .hidden {
            display: none !important;
        }
        .productivity-card {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .thank-you-effect {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        .sad-effect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
        
        /* Mobile-specific styles */
        body {
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, textarea, button {
            -webkit-appearance: none;
            border-radius: 8px;
        }
        
        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="w-full px-4 py-6 max-w-sm mx-auto">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Guardians of Site</h1>
            <p class="text-gray-600">Supervisor Productivity Tracker</p>
        </div>

        <!-- Card 1: Basic Information -->
        <div id="card1" class="bg-white rounded-xl shadow-lg p-6 mb-4 card-transition">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">1</span>
                Basic Information
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor Name</label>
                    <input type="text" id="supervisorName" placeholder="Enter supervisor name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Area</label>
                    <input type="text" id="area" placeholder="Enter work area" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Manpower</label>
                        <input type="number" id="manpower" placeholder="Number of men" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Overtime Hours</label>
                        <input type="number" id="overtime" placeholder="OT hours" min="0" step="0.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div id="manpowerDisplay" class="bg-blue-50 p-3 rounded-lg text-center text-blue-800 font-medium hidden">
                    <!-- Dynamic manpower display -->
                </div>
            </div>
            
            <button onclick="goToCard2()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg mt-6 transition-colors">
                Next: Add Work Entries
            </button>
        </div>

        <!-- Card 2: Work Entries -->
        <div id="card2" class="bg-white rounded-xl shadow-lg p-6 mb-4 card-transition hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">2</span>
                Work Entries
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Work Type</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="setWorkType('erection')" id="erectionBtn" class="px-4 py-2 border-2 border-green-500 text-green-500 rounded-lg hover:bg-green-500 hover:text-white transition-colors">
                            Erection
                        </button>
                        <button onclick="setWorkType('dismantling')" id="dismantlingBtn" class="px-4 py-2 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-500 hover:text-white transition-colors">
                            Dismantling
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Length (m)</label>
                        <input type="number" id="length" placeholder="0" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Width (m)</label>
                        <input type="number" id="width" placeholder="0" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Height (m)</label>
                        <input type="number" id="height" placeholder="0" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                        <input type="number" id="quantity" placeholder="1" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div id="volumeDisplay" class="bg-gray-50 p-3 rounded-lg text-center text-gray-700 hidden">
                    <!-- Volume calculation display -->
                </div>
                
                <button onclick="addEntry()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Add Entry
                </button>
                
                <div id="entriesList" class="space-y-2">
                    <!-- Added entries will appear here -->
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Remarks</label>
                    <textarea id="remarks" placeholder="Add any remarks or notes..." rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="goToCard1()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Back
                </button>
                <button onclick="generateReport()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Generate Report
                </button>
            </div>
        </div>

        <!-- Card 3: Report -->
        <div id="card3" class="bg-white rounded-xl shadow-lg p-6 mb-4 card-transition hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">3</span>
                Productivity Report
            </h2>
            
            <div id="reportContent">
                <!-- Report content will be generated here -->
            </div>
            
            <div class="flex gap-2 mt-6">
                <button onclick="goToCard2()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Back
                </button>
                <button onclick="downloadReport()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    üì• Download
                </button>
                <button onclick="shareReport()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    üì§ Share
                </button>
            </div>
        </div>

        <!-- Share Modal -->
        <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-6 m-4 max-w-sm w-full">
                <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">üì§ Share Report</h3>
                <p class="text-sm text-gray-600 mb-4 text-center">Choose how you want to share this report:</p>
                
                <div class="space-y-3">
                    <button onclick="shareViaWhatsApp()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        üì± WhatsApp
                    </button>
                    
                    <button onclick="shareViaEmail()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        üìß Email
                    </button>
                    
                    <button onclick="shareViaTelegram()" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        ‚úàÔ∏è Telegram
                    </button>
                    
                    <button onclick="copyReportLink()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        üîó Copy Link
                    </button>
                    
                    <button onclick="shareViaWebShare()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        üì≤ More Options
                    </button>
                </div>
                
                <button onclick="closeShareModal()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors mt-4">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentWorkType = '';
        let workEntries = [];
        let basicInfo = {};

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Update manpower display
        function updateManpowerDisplay() {
            const manpower = document.getElementById('manpower').value;
            const overtime = document.getElementById('overtime').value || 0;
            const display = document.getElementById('manpowerDisplay');
            
            if (manpower) {
                display.innerHTML = `${manpower} men √ó 8 + ${overtime} overtime hours`;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        // Update volume calculation
        function updateVolumeDisplay() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const display = document.getElementById('volumeDisplay');
            
            if (length && width && height) {
                const volume = (length * width * height * quantity).toFixed(2);
                display.innerHTML = `Volume: ${volume} m¬≥ (${length} √ó ${width} √ó ${height} √ó ${quantity})`;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        // Event listeners for real-time updates
        document.getElementById('manpower').addEventListener('input', updateManpowerDisplay);
        document.getElementById('overtime').addEventListener('input', updateManpowerDisplay);
        document.getElementById('length').addEventListener('input', updateVolumeDisplay);
        document.getElementById('width').addEventListener('input', updateVolumeDisplay);
        document.getElementById('height').addEventListener('input', updateVolumeDisplay);
        document.getElementById('quantity').addEventListener('input', updateVolumeDisplay);

        function setWorkType(type) {
            currentWorkType = type;
            document.getElementById('erectionBtn').classList.remove('bg-green-500', 'text-white', 'bg-red-500');
            document.getElementById('dismantlingBtn').classList.remove('bg-green-500', 'text-white', 'bg-red-500');
            
            if (type === 'erection') {
                document.getElementById('erectionBtn').classList.add('bg-green-500', 'text-white');
            } else {
                document.getElementById('dismantlingBtn').classList.add('bg-red-500', 'text-white');
            }
        }

        function addEntry() {
            if (!currentWorkType) {
                alert('Please select work type (Erection or Dismantling)');
                return;
            }
            
            const length = parseFloat(document.getElementById('length').value);
            const width = parseFloat(document.getElementById('width').value);
            const height = parseFloat(document.getElementById('height').value);
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            
            if (!length || !width || !height) {
                alert('Please enter length, width, and height');
                return;
            }
            
            const volume = length * width * height * quantity;
            const entry = {
                type: currentWorkType,
                length,
                width,
                height,
                quantity,
                volume: volume.toFixed(2)
            };
            
            workEntries.push(entry);
            displayEntries();
            clearEntryForm();
        }

        function displayEntries() {
            const list = document.getElementById('entriesList');
            list.innerHTML = '';
            
            workEntries.forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = `p-3 rounded-lg border-l-4 ${entry.type === 'erection' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
                entryDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-medium ${entry.type === 'erection' ? 'text-green-700' : 'text-red-700'}">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}</span>
                            <p class="text-sm text-gray-600">${entry.length}√ó${entry.width}√ó${entry.height} √ó ${entry.quantity} = ${entry.volume} m¬≥</p>
                        </div>
                        <button onclick="removeEntry(${index})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                    </div>
                `;
                list.appendChild(entryDiv);
            });
        }

        function removeEntry(index) {
            workEntries.splice(index, 1);
            displayEntries();
        }

        function clearEntryForm() {
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('volumeDisplay').classList.add('hidden');
            currentWorkType = '';
            document.getElementById('erectionBtn').classList.remove('bg-green-500', 'text-white');
            document.getElementById('dismantlingBtn').classList.remove('bg-red-500', 'text-white');
        }

        function goToCard1() {
            document.getElementById('card1').classList.remove('hidden');
            document.getElementById('card2').classList.add('hidden');
            document.getElementById('card3').classList.add('hidden');
        }

        function goToCard2() {
            const date = document.getElementById('date').value;
            const supervisorName = document.getElementById('supervisorName').value;
            const area = document.getElementById('area').value;
            const manpower = document.getElementById('manpower').value;
            const overtime = document.getElementById('overtime').value || 0;
            
            if (!date || !supervisorName || !area || !manpower) {
                alert('Please fill in all required fields');
                return;
            }
            
            basicInfo = { date, supervisorName, area, manpower: parseInt(manpower), overtime: parseFloat(overtime) };
            
            document.getElementById('card1').classList.add('hidden');
            document.getElementById('card2').classList.remove('hidden');
            document.getElementById('card3').classList.add('hidden');
        }

        function generateReport() {
            if (workEntries.length === 0) {
                alert('Please add at least one work entry');
                return;
            }
            
            const remarks = document.getElementById('remarks').value;
            
            // Calculate totals
            let totalErection = 0;
            let totalDismantling = 0;
            
            workEntries.forEach(entry => {
                if (entry.type === 'erection') {
                    totalErection += parseFloat(entry.volume);
                } else {
                    totalDismantling += parseFloat(entry.volume);
                }
            });
            
            const totalManHours = (basicInfo.manpower * 8) + basicInfo.overtime;
            const productivity = ((totalErection + (totalDismantling / 2)) / totalManHours).toFixed(2);
            
            // Calculate additional metrics
            const erectionEntries = workEntries.filter(entry => entry.type === 'erection').length;
            const dismantlingEntries = workEntries.filter(entry => entry.type === 'dismantling').length;
            const avgErectionVolume = erectionEntries > 0 ? (totalErection / erectionEntries).toFixed(2) : 0;
            const avgDismantlingVolume = dismantlingEntries > 0 ? (totalDismantling / dismantlingEntries).toFixed(2) : 0;
            const totalVolume = totalErection + totalDismantling;
            const efficiencyRating = productivity >= 3 ? 'Excellent' : productivity >= 2.5 ? 'Good' : productivity >= 2 ? 'Average' : 'Below Average';
            
            // First, auto-download the report
            downloadReport();
            
            // Then generate report content for display
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div id="reportForDownload" class="space-y-4">
                    <div class="text-center border-b-2 border-blue-500 pb-4 mb-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-1">üìä SCAFFOLDING PRODUCTIVITY REPORT</h3>
                        <p class="text-sm text-gray-600 font-medium">${new Date(basicInfo.date).toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <p class="text-xs text-gray-500">Generated on ${new Date().toLocaleString()}</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-3 flex items-center">
                            üë§ SUPERVISOR INFORMATION
                        </h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="space-y-1">
                                <p><span class="font-semibold text-gray-700">Name:</span> ${basicInfo.supervisorName}</p>
                                <p><span class="font-semibold text-gray-700">Work Area:</span> ${basicInfo.area}</p>
                            </div>
                            <div class="space-y-1">
                                <p><span class="font-semibold text-gray-700">Team Size:</span> ${basicInfo.manpower} workers</p>
                                <p><span class="font-semibold text-gray-700">Overtime:</span> ${basicInfo.overtime} hours</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200">
                        <h4 class="font-bold text-green-800 mb-3 flex items-center">
                            üìà PRODUCTIVITY METRICS
                        </h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="font-semibold">Total Erection:</span>
                                    <span class="text-green-600 font-bold">${totalErection.toFixed(2)} m¬≥</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Total Dismantling:</span>
                                    <span class="text-red-600 font-bold">${totalDismantling.toFixed(2)} m¬≥</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Total Volume:</span>
                                    <span class="text-blue-600 font-bold">${totalVolume.toFixed(2)} m¬≥</span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="font-semibold">Total Man Hours:</span>
                                    <span class="font-bold">${totalManHours} hrs</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Productivity Score:</span>
                                    <span class="font-bold text-lg ${productivity >= 2.5 ? 'text-green-600' : 'text-red-600'}">${productivity}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Efficiency Rating:</span>
                                    <span class="font-bold ${productivity >= 2.5 ? 'text-green-600' : 'text-red-600'}">${efficiencyRating}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200">
                        <h4 class="font-bold text-purple-800 mb-3 flex items-center">
                            üìä DETAILED ANALYSIS
                        </h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="space-y-1">
                                <p><span class="font-semibold">Erection Entries:</span> ${erectionEntries}</p>
                                <p><span class="font-semibold">Dismantling Entries:</span> ${dismantlingEntries}</p>
                                <p><span class="font-semibold">Total Entries:</span> ${workEntries.length}</p>
                            </div>
                            <div class="space-y-1">
                                <p><span class="font-semibold">Avg Erection Vol:</span> ${avgErectionVolume} m¬≥</p>
                                <p><span class="font-semibold">Avg Dismantling Vol:</span> ${avgDismantlingVolume} m¬≥</p>
                                <p><span class="font-semibold">Vol per Hour:</span> ${(totalVolume / totalManHours).toFixed(2)} m¬≥/hr</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                            üìã WORK ENTRIES BREAKDOWN
                        </h4>
                        <div class="space-y-2 max-h-40 overflow-y-auto">
                            ${workEntries.map((entry, index) => `
                                <div class="text-sm p-3 rounded-lg border-l-4 ${entry.type === 'erection' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'} flex justify-between items-center">
                                    <div>
                                        <span class="font-semibold ${entry.type === 'erection' ? 'text-green-700' : 'text-red-700'}">${index + 1}. ${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}</span>
                                        <p class="text-xs text-gray-600">Dimensions: ${entry.length}m √ó ${entry.width}m √ó ${entry.height}m</p>
                                        <p class="text-xs text-gray-600">Quantity: ${entry.quantity} units</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold ${entry.type === 'erection' ? 'text-green-600' : 'text-red-600'}">${entry.volume} m¬≥</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${remarks ? `
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h4 class="font-bold text-yellow-800 mb-2 flex items-center">
                                üí¨ SUPERVISOR REMARKS
                            </h4>
                            <p class="text-sm text-gray-700 italic">"${remarks}"</p>
                        </div>
                    ` : ''}
                    
                    <div id="productivityCard" class="productivity-card p-6 rounded-lg text-white text-center ${productivity >= 2.5 ? 'thank-you-effect' : 'sad-effect'} border-2 border-white">
                        ${productivity >= 2.5 ? `
                            <h4 class="font-bold text-2xl mb-3">üéâ EXCELLENT PERFORMANCE! üéâ</h4>
                            <p class="text-lg mb-2">Thank You for Your Outstanding Efforts!</p>
                            <p class="text-base mb-2">‡§Ü‡§™‡§ï‡•á ‡§â‡§§‡•ç‡§ï‡•É‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3 mt-3">
                                <p class="text-sm">Productivity Score: <span class="font-bold text-xl">${productivity}</span></p>
                                <p class="text-xs">Keep up the excellent work!</p>
                            </div>
                        ` : `
                            <h4 class="font-bold text-2xl mb-3">üòî PERFORMANCE NEEDS IMPROVEMENT</h4>
                            <p class="text-lg mb-2">This is not what we are expecting from you</p>
                            <p class="text-base mb-2">‡§Ø‡§π ‡§µ‡§π ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§ú‡§ø‡§∏‡§ï‡•Ä ‡§π‡§Æ ‡§Ü‡§™‡§∏‡•á ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç</p>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3 mt-3">
                                <p class="text-sm">Productivity Score: <span class="font-bold text-xl">${productivity}</span></p>
                                <p class="text-xs">Target: 2.5 or above</p>
                            </div>
                        `}
                    </div>
                    
                    <div class="text-center text-xs text-gray-500 border-t pt-3">
                        <p>üì± Generated by Guardians of Site</p>
                        <p>Report ID: GOS-${Date.now()}</p>
                    </div>
                </div>
            `;
            
            // Show the report page after a brief delay to allow download to start
            setTimeout(() => {
                document.getElementById('card1').classList.add('hidden');
                document.getElementById('card2').classList.add('hidden');
                document.getElementById('card3').classList.remove('hidden');
            }, 500);
        }

        function downloadReport() {
            // Create ID card format container
            const idCardContainer = document.createElement('div');
            idCardContainer.style.cssText = `
                width: 600px;
                min-height: 400px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 20px;
                font-family: Arial, sans-serif;
                color: white;
                position: absolute;
                top: -9999px;
                left: -9999px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            // Calculate metrics
            const totalErection = workEntries.filter(entry => entry.type === 'erection').reduce((sum, entry) => sum + parseFloat(entry.volume), 0);
            const totalDismantling = workEntries.filter(entry => entry.type === 'dismantling').reduce((sum, entry) => sum + parseFloat(entry.volume), 0);
            const totalManHours = (basicInfo.manpower * 8) + basicInfo.overtime;
            const productivity = ((totalErection + (totalDismantling / 2)) / totalManHours).toFixed(2);
            const totalVolume = totalErection + totalDismantling;
            const efficiencyRating = productivity >= 3 ? 'Excellent' : productivity >= 2.5 ? 'Good' : productivity >= 2 ? 'Average' : 'Below Average';
            
            idCardContainer.innerHTML = `
                <!-- Header -->
                <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 15px;">
                    <h1 style="margin: 0; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                        üèóÔ∏è GUARDIANS OF SITE
                    </h1>
                    <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;">
                        ${new Date(basicInfo.date).toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                    </p>
                </div>
                
                <!-- Main Content Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Left Column -->
                    <div>
                        <!-- Supervisor Info -->
                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; margin-bottom: 15px; backdrop-filter: blur(10px);">
                            <h3 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold; display: flex; align-items: center;">
                                üë§ SUPERVISOR DETAILS
                            </h3>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Name:</strong> ${basicInfo.supervisorName}</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Area:</strong> ${basicInfo.area}</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Team:</strong> ${basicInfo.manpower} workers</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Overtime:</strong> ${basicInfo.overtime} hrs</p>
                        </div>
                        
                        <!-- Work Summary -->
                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <h3 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">üìä WORK SUMMARY</h3>
                            <p style="margin: 5px 0; font-size: 13px;"><strong>Erection:</strong> ${totalErection.toFixed(2)} m¬≥</p>
                            <p style="margin: 5px 0; font-size: 13px;"><strong>Dismantling:</strong> ${totalDismantling.toFixed(2)} m¬≥</p>
                            <p style="margin: 5px 0; font-size: 13px;"><strong>Total Volume:</strong> ${totalVolume.toFixed(2)} m¬≥</p>
                            <p style="margin: 5px 0; font-size: 13px;"><strong>Total Entries:</strong> ${workEntries.length}</p>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div>
                        <!-- Performance Metrics -->
                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; margin-bottom: 15px; backdrop-filter: blur(10px);">
                            <h3 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">üìà PERFORMANCE</h3>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Man Hours:</strong> ${totalManHours} hrs</p>
                            <p style="margin: 5px 0; font-size: 14px;"><strong>Vol/Hour:</strong> ${(totalVolume / totalManHours).toFixed(2)} m¬≥/hr</p>
                            <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px; text-align: center;">
                                <p style="margin: 0; font-size: 12px; opacity: 0.9;">PRODUCTIVITY SCORE</p>
                                <p style="margin: 5px 0 0 0; font-size: 28px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">${productivity}</p>
                            </div>
                            <p style="margin: 5px 0; font-size: 14px; text-align: center;"><strong>Rating:</strong> ${efficiencyRating}</p>
                        </div>
                        
                        <!-- Status Badge -->
                        <div style="background: ${productivity >= 2.5 ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #ef4444, #dc2626)'}; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                            <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold;">
                                ${productivity >= 2.5 ? 'üéâ EXCELLENT!' : '‚ö†Ô∏è IMPROVE'}
                            </h3>
                            <p style="margin: 0; font-size: 12px; opacity: 0.95;">
                                ${productivity >= 2.5 ? 'Outstanding Performance!' : 'Needs Improvement'}
                            </p>
                            <p style="margin: 5px 0 0 0; font-size: 11px; opacity: 0.8;">
                                ${productivity >= 2.5 ? '‡§Ü‡§™‡§ï‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!' : '‡§¨‡•á‡§π‡§§‡§∞ ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§π‡•à'}
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Work Entries (if space allows) -->
                ${workEntries.length <= 4 ? `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 14px; font-weight: bold;">üìã WORK ENTRIES</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px;">
                        ${workEntries.map((entry, index) => `
                            <div style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 6px; border-left: 3px solid ${entry.type === 'erection' ? '#10b981' : '#ef4444'};">
                                <strong>${index + 1}. ${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}</strong><br>
                                ${entry.length}√ó${entry.width}√ó${entry.height} √ó ${entry.quantity} = ${entry.volume}m¬≥
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : `
                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
                    <p style="margin: 0; font-size: 12px; opacity: 0.9;">üìã ${workEntries.length} work entries completed</p>
                </div>
                `}
                
                <!-- Footer -->
                <div style="text-align: center; font-size: 10px; opacity: 0.8; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px;">
                    <p style="margin: 0;">üì± Generated by Guardians of Site</p>
                    <p style="margin: 2px 0 0 0;">Report ID: GOS-${Date.now()} | ${new Date().toLocaleString()}</p>
                </div>
            `;
            
            // Temporarily add to body for rendering
            document.body.appendChild(idCardContainer);
            
            // Wait for fonts and styles to load
            setTimeout(() => {
                html2canvas(idCardContainer, {
                    backgroundColor: '#667eea',
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    width: 600,
                    height: idCardContainer.offsetHeight,
                    logging: false
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `GuardiansOfSite_${basicInfo.supervisorName}_${basicInfo.date}.jpeg`;
                    link.href = canvas.toDataURL('image/jpeg', 0.95);
                    
                    // For mobile compatibility
                    if (navigator.userAgent.match(/iPhone|iPad|iPod|Android/i)) {
                        // Open in new window for mobile
                        const newWindow = window.open();
                        newWindow.document.write(`<img src="${link.href}" style="width:100%;height:auto;">`);
                        newWindow.document.title = `GuardiansOfSite_${basicInfo.supervisorName}_${basicInfo.date}`;
                    } else {
                        link.click();
                    }
                    
                    // Remove temporary element
                    document.body.removeChild(idCardContainer);
                }).catch(error => {
                    console.error('Error generating ID card:', error);
                    alert('Error generating ID card. Please try again.');
                    document.body.removeChild(idCardContainer);
                });
            }, 100);
        }

        function shareReport() {
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.add('hidden');
        }

        function generateShareText() {
            const totalErection = workEntries.filter(entry => entry.type === 'erection').reduce((sum, entry) => sum + parseFloat(entry.volume), 0);
            const totalDismantling = workEntries.filter(entry => entry.type === 'dismantling').reduce((sum, entry) => sum + parseFloat(entry.volume), 0);
            const totalManHours = (basicInfo.manpower * 8) + basicInfo.overtime;
            const productivity = ((totalErection + (totalDismantling / 2)) / totalManHours).toFixed(2);
            
            return `üìä SCAFFOLDING PRODUCTIVITY REPORT
üìÖ Date: ${new Date(basicInfo.date).toLocaleDateString()}
üë§ Supervisor: ${basicInfo.supervisorName}
üìç Area: ${basicInfo.area}

üìà PERFORMANCE METRICS:
‚Ä¢ Total Erection: ${totalErection.toFixed(2)} m¬≥
‚Ä¢ Total Dismantling: ${totalDismantling.toFixed(2)} m¬≥
‚Ä¢ Team Size: ${basicInfo.manpower} workers
‚Ä¢ Overtime: ${basicInfo.overtime} hours
‚Ä¢ Productivity Score: ${productivity}
‚Ä¢ Status: ${productivity >= 2.5 ? '‚úÖ Excellent Performance!' : '‚ö†Ô∏è Needs Improvement'}

Generated by Guardians of Site App`;
        }

        function shareViaWhatsApp() {
            const text = encodeURIComponent(generateShareText());
            const url = `https://wa.me/?text=${text}`;
            window.open(url, '_blank');
            closeShareModal();
        }

        function shareViaEmail() {
            const subject = encodeURIComponent(`Scaffolding Report - ${basicInfo.supervisorName} - ${basicInfo.date}`);
            const body = encodeURIComponent(generateShareText());
            const url = `mailto:?subject=${subject}&body=${body}`;
            window.open(url, '_blank');
            closeShareModal();
        }

        function shareViaTelegram() {
            const text = encodeURIComponent(generateShareText());
            const url = `https://t.me/share/url?text=${text}`;
            window.open(url, '_blank');
            closeShareModal();
        }

        function copyReportLink() {
            const reportText = generateShareText();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(reportText).then(() => {
                    alert('üìã Report details copied to clipboard!');
                }).catch(() => {
                    fallbackCopyText(reportText);
                });
            } else {
                fallbackCopyText(reportText);
            }
            closeShareModal();
        }

        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('üìã Report details copied to clipboard!');
            } catch (err) {
                alert('‚ùå Could not copy to clipboard. Please copy manually.');
            }
            document.body.removeChild(textArea);
        }

        function shareViaWebShare() {
            if (navigator.share) {
                const reportElement = document.getElementById('reportForDownload');
                
                html2canvas(reportElement, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true,
                    allowTaint: true
                }).then(canvas => {
                    canvas.toBlob(blob => {
                        const file = new File([blob], `Scaffolding_Report_${basicInfo.supervisorName}_${basicInfo.date}.jpeg`, { type: 'image/jpeg' });
                        
                        navigator.share({
                            title: `Scaffolding Report - ${basicInfo.supervisorName}`,
                            text: generateShareText(),
                            files: [file]
                        }).catch(error => {
                            console.log('Error sharing:', error);
                            // Fallback to text sharing if file sharing fails
                            navigator.share({
                                title: `Scaffolding Report - ${basicInfo.supervisorName}`,
                                text: generateShareText()
                            });
                        });
                    }, 'image/jpeg', 0.9);
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                copyReportLink();
            }
            closeShareModal();
        }

        // Close modal when clicking outside
        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeShareModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96400c6284e33a21',t:'MTc1MzMyNDc4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
