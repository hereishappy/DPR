<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Data Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.js.org/dist/html2canvas.min.js"></script>
    <style>
        .card-transition {
            transition: all 0.3s ease-in-out;
        }
        .hidden {
            display: none !important;
        }
        .productivity-card {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .thank-you-effect {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        .sad-effect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Scaffolding Data Collection</h1>
            <p class="text-gray-600">Supervisor Productivity Tracker</p>
        </div>

        <!-- Card 1: Basic Information -->
        <div id="card1" class="bg-white rounded-xl shadow-lg p-6 mb-4 card-transition">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">1</span>
                Basic Information
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor Name</label>
                    <input type="text" id="supervisorName" placeholder="Enter supervisor name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Area</label>
                    <input type="text" id="area" placeholder="Enter work area" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Manpower</label>
                        <input type="number" id="manpower" placeholder="Number of men" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Overtime Hours</label>
                        <input type="number" id="overtime" placeholder="OT hours" min="0" step="0.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div id="manpowerDisplay" class="bg-blue-50 p-3 rounded-lg text-center text-blue-800 font-medium hidden">
                    <!-- Dynamic manpower display -->
                </div>
            </div>
            
            <button onclick="goToCard2()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg mt-6 transition-colors">
                Next: Add Work Entries
            </button>
        </div>

        <!-- Card 2: Work Entries -->
        <div id="card2" class="bg-white rounded-xl shadow-lg p-6 mb-4 card-transition hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">2</span>
                Work Entries
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Work Type</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="setWorkType('erection')" id="erectionBtn" class="px-4 py-2 border-2 border-green-500 text-green-500 rounded-lg hover:bg-green-500 hover:text-white transition-colors">
                            Erection
                        </button>
                        <button onclick="setWorkType('dismantling')" id="dismantlingBtn" class="px-4 py-2 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-500 hover:text-white transition-colors">
                            Dismantling
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Length (m)</label>
                        <input type="number" id="length" placeholder="0" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Width (m)</label>
                        <input type="number" id="width" placeholder="0" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Height (m)</label>
                        <input type="number" id="height" placeholder="0" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                        <input type="number" id="quantity" placeholder="1" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div id="volumeDisplay" class="bg-gray-50 p-3 rounded-lg text-center text-gray-700 hidden">
                    <!-- Volume calculation display -->
                </div>
                
                <button onclick="addEntry()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Add Entry
                </button>
                
                <div id="entriesList" class="space-y-2">
                    <!-- Added entries will appear here -->
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Remarks</label>
                    <textarea id="remarks" placeholder="Add any remarks or notes..." rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="goToCard1()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Back
                </button>
                <button onclick="generateReport()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Generate Report
                </button>
            </div>
        </div>

        <!-- Card 3: Report -->
        <div id="card3" class="bg-white rounded-xl shadow-lg p-6 mb-4 card-transition hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">3</span>
                Productivity Report
            </h2>
            
            <div id="reportContent">
                <!-- Report content will be generated here -->
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="goToCard2()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Back
                </button>
                <button onclick="downloadReport()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Download JPEG
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentWorkType = '';
        let workEntries = [];
        let basicInfo = {};

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Update manpower display
        function updateManpowerDisplay() {
            const manpower = document.getElementById('manpower').value;
            const overtime = document.getElementById('overtime').value || 0;
            const display = document.getElementById('manpowerDisplay');
            
            if (manpower) {
                display.innerHTML = `${manpower} men × 8 + ${overtime} overtime hours`;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        // Update volume calculation
        function updateVolumeDisplay() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const display = document.getElementById('volumeDisplay');
            
            if (length && width && height) {
                const volume = (length * width * height * quantity).toFixed(2);
                display.innerHTML = `Volume: ${volume} m³ (${length} × ${width} × ${height} × ${quantity})`;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        // Event listeners for real-time updates
        document.getElementById('manpower').addEventListener('input', updateManpowerDisplay);
        document.getElementById('overtime').addEventListener('input', updateManpowerDisplay);
        document.getElementById('length').addEventListener('input', updateVolumeDisplay);
        document.getElementById('width').addEventListener('input', updateVolumeDisplay);
        document.getElementById('height').addEventListener('input', updateVolumeDisplay);
        document.getElementById('quantity').addEventListener('input', updateVolumeDisplay);

        function setWorkType(type) {
            currentWorkType = type;
            document.getElementById('erectionBtn').classList.remove('bg-green-500', 'text-white', 'bg-red-500');
            document.getElementById('dismantlingBtn').classList.remove('bg-green-500', 'text-white', 'bg-red-500');
            
            if (type === 'erection') {
                document.getElementById('erectionBtn').classList.add('bg-green-500', 'text-white');
            } else {
                document.getElementById('dismantlingBtn').classList.add('bg-red-500', 'text-white');
            }
        }

        function addEntry() {
            if (!currentWorkType) {
                alert('Please select work type (Erection or Dismantling)');
                return;
            }
            
            const length = parseFloat(document.getElementById('length').value);
            const width = parseFloat(document.getElementById('width').value);
            const height = parseFloat(document.getElementById('height').value);
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            
            if (!length || !width || !height) {
                alert('Please enter length, width, and height');
                return;
            }
            
            const volume = length * width * height * quantity;
            const entry = {
                type: currentWorkType,
                length,
                width,
                height,
                quantity,
                volume: volume.toFixed(2)
            };
            
            workEntries.push(entry);
            displayEntries();
            clearEntryForm();
        }

        function displayEntries() {
            const list = document.getElementById('entriesList');
            list.innerHTML = '';
            
            workEntries.forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = `p-3 rounded-lg border-l-4 ${entry.type === 'erection' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`;
                entryDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="font-medium ${entry.type === 'erection' ? 'text-green-700' : 'text-red-700'}">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}</span>
                            <p class="text-sm text-gray-600">${entry.length}×${entry.width}×${entry.height} × ${entry.quantity} = ${entry.volume} m³</p>
                        </div>
                        <button onclick="removeEntry(${index})" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                    </div>
                `;
                list.appendChild(entryDiv);
            });
        }

        function removeEntry(index) {
            workEntries.splice(index, 1);
            displayEntries();
        }

        function clearEntryForm() {
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('volumeDisplay').classList.add('hidden');
            currentWorkType = '';
            document.getElementById('erectionBtn').classList.remove('bg-green-500', 'text-white');
            document.getElementById('dismantlingBtn').classList.remove('bg-red-500', 'text-white');
        }

        function goToCard1() {
            document.getElementById('card1').classList.remove('hidden');
            document.getElementById('card2').classList.add('hidden');
            document.getElementById('card3').classList.add('hidden');
        }

        function goToCard2() {
            const date = document.getElementById('date').value;
            const supervisorName = document.getElementById('supervisorName').value;
            const area = document.getElementById('area').value;
            const manpower = document.getElementById('manpower').value;
            const overtime = document.getElementById('overtime').value || 0;
            
            if (!date || !supervisorName || !area || !manpower) {
                alert('Please fill in all required fields');
                return;
            }
            
            basicInfo = { date, supervisorName, area, manpower: parseInt(manpower), overtime: parseFloat(overtime) };
            
            document.getElementById('card1').classList.add('hidden');
            document.getElementById('card2').classList.remove('hidden');
            document.getElementById('card3').classList.add('hidden');
        }

        function generateReport() {
            if (workEntries.length === 0) {
                alert('Please add at least one work entry');
                return;
            }
            
            const remarks = document.getElementById('remarks').value;
            
            // Calculate totals
            let totalErection = 0;
            let totalDismantling = 0;
            
            workEntries.forEach(entry => {
                if (entry.type === 'erection') {
                    totalErection += parseFloat(entry.volume);
                } else {
                    totalDismantling += parseFloat(entry.volume);
                }
            });
            
            const totalManHours = (basicInfo.manpower * 8) + basicInfo.overtime;
            const productivity = ((totalErection + (totalDismantling / 2)) / totalManHours).toFixed(2);
            
            // Generate report content
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div id="reportForDownload" class="space-y-4">
                    <div class="text-center border-b pb-4">
                        <h3 class="text-lg font-bold text-gray-800">Scaffolding Productivity Report</h3>
                        <p class="text-sm text-gray-600">${new Date(basicInfo.date).toLocaleDateString()}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><span class="font-medium">Supervisor:</span> ${basicInfo.supervisorName}</p>
                            <p><span class="font-medium">Area:</span> ${basicInfo.area}</p>
                        </div>
                        <div>
                            <p><span class="font-medium">Manpower:</span> ${basicInfo.manpower} men</p>
                            <p><span class="font-medium">Overtime:</span> ${basicInfo.overtime} hours</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">Work Summary</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p><span class="font-medium">Total Erection:</span> ${totalErection.toFixed(2)} m³</p>
                                <p><span class="font-medium">Total Dismantling:</span> ${totalDismantling.toFixed(2)} m³</p>
                            </div>
                            <div>
                                <p><span class="font-medium">Total Man Hours:</span> ${totalManHours}</p>
                                <p><span class="font-medium">Productivity:</span> ${productivity}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <h4 class="font-medium text-gray-800">Work Entries:</h4>
                        ${workEntries.map(entry => `
                            <div class="text-sm p-2 rounded border-l-4 ${entry.type === 'erection' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}">
                                <span class="font-medium">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}:</span>
                                ${entry.length}×${entry.width}×${entry.height} × ${entry.quantity} = ${entry.volume} m³
                            </div>
                        `).join('')}
                    </div>
                    
                    ${remarks ? `
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <h4 class="font-medium text-gray-800 mb-1">Remarks:</h4>
                            <p class="text-sm text-gray-700">${remarks}</p>
                        </div>
                    ` : ''}
                    
                    <div id="productivityCard" class="productivity-card p-4 rounded-lg text-white text-center ${productivity >= 2.5 ? 'thank-you-effect' : 'sad-effect'}">
                        ${productivity >= 2.5 ? `
                            <h4 class="font-bold text-lg mb-2">🎉 Thank You for Your Efforts! 🎉</h4>
                            <p class="text-sm">आपके प्रयासों के लिए धन्यवाद!</p>
                            <p class="text-xs mt-1">Productivity: ${productivity} (Excellent Performance)</p>
                        ` : `
                            <h4 class="font-bold text-lg mb-2">😔 Performance Below Expectations</h4>
                            <p class="text-sm">यह वह नहीं है जिसकी हम आपसे अपेक्षा करते हैं</p>
                            <p class="text-sm">This is not what we are expecting from you</p>
                            <p class="text-xs mt-1">Productivity: ${productivity} (Needs Improvement)</p>
                        `}
                    </div>
                </div>
            `;
            
            document.getElementById('card1').classList.add('hidden');
            document.getElementById('card2').classList.add('hidden');
            document.getElementById('card3').classList.remove('hidden');
        }

        function downloadReport() {
            const reportElement = document.getElementById('reportForDownload');
            
            html2canvas(reportElement, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Scaffolding_Report_${basicInfo.supervisorName}_${basicInfo.date}.jpeg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
            }).catch(error => {
                console.error('Error generating report:', error);
                alert('Error generating report. Please try again.');
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963fa5b586cb8a1a',t:'MTc1MzMyMDU3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
