<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Work Progress Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-2 sm:p-4">
    <div class="max-w-md mx-auto">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Scaffolding Work Progress</h1>
            <p class="text-sm text-gray-600">Daily Reporting System</p>
        </div>

        <!-- Supervisor Info Panel -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <h2 class="text-lg font-bold text-gray-800 mb-3">Supervisor Information</h2>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor Name*</label>
                    <select id="supervisorName" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Supervisor</option>
                        <option value="Mahendra Kumar">Mahendra Kumar</option>
                        <option value="Pintu Sah">Pintu Sah</option>
                        <option value="Harkirat Singh">Harkirat Singh</option>
                        <option value="Sunil Chahuan">Sunil Chahuan</option>
                        <option value="Vijay Chauhan">Vijay Chauhan</option>
                        <option value="OTHER1">OTHER1</option>
                        <option value="OTHER2">OTHER2</option>
                        <option value="OTHER3">OTHER3</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Plant*</label>
                    <select id="plant" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Plant</option>
                        <option value="Pulp Mill">Pulp Mill</option>
                        <option value="SRP">SRP</option>
                        <option value="Utility">Utility</option>
                        <option value="PM">PM</option>
                        <option value="SFS">SFS</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Work Date*</label>
                    <input type="date" id="workDate" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <!-- Manpower and OT Hours fields moved here -->
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Manpower*</label>
                        <input type="number" id="manpower" min="0" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                               placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Regular Hours</label>
                        <input type="number" id="regularHours" min="0" readonly
                               class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg" 
                               placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">OT Hours</label>
                        <input type="number" id="otHours" min="0" step="0.5"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                               placeholder="0">
                    </div>
                </div>
                
                <button id="startReportBtn" class="w-full px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                    Start Report
                </button>
            </div>
        </div>

        <!-- Work Entry Form - Initially Hidden -->
        <div id="workEntrySection" class="hidden">
            <!-- Summary Dashboard -->
            <div class="grid grid-cols-2 gap-2 mb-4">
                <div class="bg-blue-50 p-3 rounded-lg text-center shadow">
                    <div class="text-xl font-bold text-blue-600" id="totalCubicMeters">0.00</div>
                    <div class="text-xs text-blue-700">Total Cubic Meters</div>
                </div>
                <div class="bg-green-50 p-3 rounded-lg text-center shadow">
                    <div class="text-xl font-bold text-green-600" id="totalProductivity">0.00</div>
                    <div class="text-xs text-green-700">Productivity (m³/hr)</div>
                </div>
            </div>

            <!-- Manpower Summary -->
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <h2 class="text-lg font-bold text-gray-800 mb-2">Manpower Summary</h2>
                <div class="grid grid-cols-3 gap-2">
                    <div class="bg-blue-50 p-2 rounded-lg text-center">
                        <div class="text-lg font-bold text-blue-600" id="summaryManpower">0</div>
                        <div class="text-xs text-blue-700">Manpower</div>
                    </div>
                    <div class="bg-blue-50 p-2 rounded-lg text-center">
                        <div class="text-lg font-bold text-blue-600" id="summaryRegularHours">0</div>
                        <div class="text-xs text-blue-700">Regular Hours</div>
                    </div>
                    <div class="bg-blue-50 p-2 rounded-lg text-center">
                        <div class="text-lg font-bold text-blue-600" id="summaryOTHours">0</div>
                        <div class="text-xs text-blue-700">OT Hours</div>
                    </div>
                </div>
            </div>

            <!-- Work Entry Form -->
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <h2 class="text-lg font-bold text-gray-800 mb-3">Add Work Entry</h2>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Work Type*</label>
                        <select id="workType" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select work type</option>
                            <option value="Erection">Erection</option>
                            <option value="Dismantling">Dismantling</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Area/Zone*</label>
                        <input type="text" id="workArea" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                               placeholder="Enter area or zone">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Length (m)*</label>
                            <input type="number" id="length" step="0.01" min="0" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Width (m)*</label>
                            <input type="number" id="width" step="0.01" min="0" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Height (m)*</label>
                            <input type="number" id="height" step="0.01" min="0" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Cubic Meters (m³)</label>
                            <input type="number" id="cubicMeters" step="0.01" min="0" readonly
                                   class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg" 
                                   placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Quantity*</label>
                            <input type="number" id="quantity" min="1" required value="1"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="1">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="workNotes" rows="2" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                  placeholder="Add any additional notes here"></textarea>
                    </div>
                    
                    <button id="addEntryBtn" class="w-full px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        Add Entry
                    </button>
                </div>
            </div>
            
            <!-- Work Entries Table -->
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <h2 class="text-lg font-bold text-gray-800 mb-3">Work Entries</h2>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th scope="col" class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Area</th>
                                <th scope="col" class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
                                <th scope="col" class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">m³</th>
                                <th scope="col" class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                <th scope="col" class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Act</th>
                            </tr>
                        </thead>
                        <tbody id="entriesTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Entries will be added here dynamically -->
                            <tr class="text-center text-sm text-gray-500">
                                <td colspan="6" class="px-2 py-3">No entries added yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Report Actions -->
            <div class="mb-4">
                <button id="downloadReportBtn" class="w-full px-4 py-3 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Download Report
                </button>
            </div>
        </div>
        
        <!-- Report Preview Section - For generating image -->
        <div id="reportPreview" class="hidden bg-white p-6 rounded-xl">
            <div class="text-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">Scaffolding Work Report</h2>
                <p id="reportDate" class="text-sm text-gray-600"></p>
            </div>
            
            <div class="mb-4">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <p class="text-sm font-medium text-gray-700">Supervisor:</p>
                        <p id="previewSupervisor" class="text-sm text-gray-800"></p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-700">Plant:</p>
                        <p id="previewPlant" class="text-sm text-gray-800"></p>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <p class="text-sm font-medium text-gray-700">Manpower:</p>
                        <p id="previewManpower" class="text-sm text-gray-800"></p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-700">Regular Hours:</p>
                        <p id="previewRegularHours" class="text-sm text-gray-800"></p>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-700">OT Hours:</p>
                        <p id="previewOTHours" class="text-sm text-gray-800"></p>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <table class="min-w-full border border-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="border border-gray-200 px-2 py-1 text-xs text-gray-700">No.</th>
                            <th class="border border-gray-200 px-2 py-1 text-xs text-gray-700">Type</th>
                            <th class="border border-gray-200 px-2 py-1 text-xs text-gray-700">Area</th>
                            <th class="border border-gray-200 px-2 py-1 text-xs text-gray-700">Size (L×W×H)</th>
                            <th class="border border-gray-200 px-2 py-1 text-xs text-gray-700">m³</th>
                            <th class="border border-gray-200 px-2 py-1 text-xs text-gray-700">Qty</th>
                        </tr>
                    </thead>
                    <tbody id="previewTableBody">
                        <!-- Preview entries will be added here -->
                    </tbody>
                </table>
            </div>
            
            <div class="grid grid-cols-3 gap-2 mb-4">
                <div class="border border-gray-200 p-2 rounded">
                    <p class="text-xs font-medium text-gray-700">Total Cubic Meters:</p>
                    <p id="previewTotalCubicMeters" class="text-sm font-bold text-gray-800"></p>
                </div>
                <div class="border border-gray-200 p-2 rounded">
                    <p class="text-xs font-medium text-gray-700">Total Man-hours:</p>
                    <p id="previewTotalManHours" class="text-sm font-bold text-gray-800"></p>
                </div>
                <div class="border border-gray-200 p-2 rounded">
                    <p class="text-xs font-medium text-gray-700">Productivity:</p>
                    <p id="previewProductivity" class="text-sm font-bold text-gray-800"></p>
                </div>
            </div>
            
            <div class="text-xs text-gray-500 text-center">
                <p>Generated on <span id="previewGeneratedDate"></span></p>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-xs w-full mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Confirm Action</h3>
            <p id="confirmationMessage" class="text-gray-600 mb-6">Are you sure you want to proceed?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelAction" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                    Cancel
                </button>
                <button id="confirmAction" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                    Confirm
                </button>
            </div>
        </div>
    </div>
    
    <!-- Thank You Modal -->
    <div id="thankYouModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
            <div id="highProductivityCard" class="hidden">
                <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-4 rounded-lg text-white mb-4">
                    <div class="text-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-center mb-2">Outstanding Work!</h3>
                    <p class="text-center mb-2">Thank you for your excellent contribution!</p>
                    <p class="text-center text-sm">आपके उत्कृष्ट योगदान के लिए धन्यवाद!</p>
                </div>
                <p class="text-gray-600 mb-4 text-center">Your productivity is exceptional. Keep up the great work!</p>
            </div>
            
            <div id="lowProductivityCard" class="hidden">
                <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-4 rounded-lg text-white mb-4">
                    <div class="text-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-center mb-2">Thank You!</h3>
                    <p class="text-center">Let's aim for higher productivity tomorrow.</p>
                </div>
                <p class="text-gray-600 mb-4 text-center">Your report has been saved. With some adjustments, we can improve our efficiency.</p>
            </div>
            
            <div class="flex justify-center">
                <button id="closeThankYouModal" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize data storage
        let workEntries = [];
        let currentEditIndex = -1;
        let supervisorInfo = {
            name: '',
            plant: '',
            date: '',
            manpower: 0,
            regularHours: 0,
            otHours: 0
        };
        
        // DOM Elements
        const supervisorNameSelect = document.getElementById('supervisorName');
        const plantSelect = document.getElementById('plant');
        const workDateInput = document.getElementById('workDate');
        const manpowerInput = document.getElementById('manpower');
        const regularHoursInput = document.getElementById('regularHours');
        const otHoursInput = document.getElementById('otHours');
        const startReportBtn = document.getElementById('startReportBtn');
        const workEntrySection = document.getElementById('workEntrySection');
        
        const workTypeSelect = document.getElementById('workType');
        const workAreaInput = document.getElementById('workArea');
        const lengthInput = document.getElementById('length');
        const widthInput = document.getElementById('width');
        const heightInput = document.getElementById('height');
        const cubicMetersInput = document.getElementById('cubicMeters');
        const quantityInput = document.getElementById('quantity');
        const workNotesInput = document.getElementById('workNotes');
        const addEntryBtn = document.getElementById('addEntryBtn');
        const entriesTableBody = document.getElementById('entriesTableBody');
        
        const downloadReportBtn = document.getElementById('downloadReportBtn');
        
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmationMessage = document.getElementById('confirmationMessage');
        const cancelActionBtn = document.getElementById('cancelAction');
        const confirmActionBtn = document.getElementById('confirmAction');
        
        const thankYouModal = document.getElementById('thankYouModal');
        const highProductivityCard = document.getElementById('highProductivityCard');
        const lowProductivityCard = document.getElementById('lowProductivityCard');
        const closeThankYouModalBtn = document.getElementById('closeThankYouModal');
        
        // Set default date to today
        workDateInput.valueAsDate = new Date();
        
        // Start Report button click handler
        startReportBtn.addEventListener('click', startReport);
        
        // Add entry button click handler
        addEntryBtn.addEventListener('click', handleAddEntry);
        
        // Download report button click handler
        downloadReportBtn.addEventListener('click', downloadReport);
        
        // Calculate cubic meters when dimensions change
        [lengthInput, widthInput, heightInput].forEach(input => {
            input.addEventListener('input', calculateCubicMeters);
        });
        
        // Calculate regular hours when manpower changes
        manpowerInput.addEventListener('input', calculateRegularHours);
        
        // Modal cancel button
        cancelActionBtn.addEventListener('click', () => {
            confirmationModal.classList.add('hidden');
        });
        
        // Close thank you modal button
        closeThankYouModalBtn.addEventListener('click', () => {
            thankYouModal.classList.add('hidden');
        });
        
        // Function to calculate cubic meters
        function calculateCubicMeters() {
            const length = parseFloat(lengthInput.value) || 0;
            const width = parseFloat(widthInput.value) || 0;
            const height = parseFloat(heightInput.value) || 0;
            
            const cubicMeters = length * width * height;
            cubicMetersInput.value = cubicMeters.toFixed(2);
        }
        
        // Function to calculate regular hours
        function calculateRegularHours() {
            const manpower = parseInt(manpowerInput.value) || 0;
            const regularHours = manpower * 8;
            regularHoursInput.value = regularHours;
        }
        
        // Function to start a new report
        function startReport() {
            // Validate supervisor info
            if (!supervisorNameSelect.value) {
                alert('Please select a supervisor name');
                supervisorNameSelect.focus();
                return;
            }
            
            if (!plantSelect.value) {
                alert('Please select a plant');
                plantSelect.focus();
                return;
            }
            
            if (!workDateInput.value) {
                alert('Please select a work date');
                workDateInput.focus();
                return;
            }
            
            if (!manpowerInput.value || parseInt(manpowerInput.value) <= 0) {
                alert('Please enter the number of manpower');
                manpowerInput.focus();
                return;
            }
            
            // Save supervisor info
            supervisorInfo = {
                name: supervisorNameSelect.value,
                plant: plantSelect.value,
                date: workDateInput.value,
                manpower: parseInt(manpowerInput.value) || 0,
                regularHours: parseInt(regularHoursInput.value) || 0,
                otHours: parseFloat(otHoursInput.value) || 0
            };
            
            // Show work entry section
            workEntrySection.classList.remove('hidden');
            
            // Disable supervisor info inputs
            supervisorNameSelect.disabled = true;
            plantSelect.disabled = true;
            workDateInput.disabled = true;
            manpowerInput.disabled = true;
            regularHoursInput.disabled = true;
            otHoursInput.disabled = true;
            startReportBtn.disabled = true;
            startReportBtn.classList.add('bg-gray-400');
            startReportBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            
            // Update manpower summary
            updateManpowerSummary();
        }
        
        // Function to update manpower summary
        function updateManpowerSummary() {
            document.getElementById('summaryManpower').textContent = supervisorInfo.manpower;
            document.getElementById('summaryRegularHours').textContent = supervisorInfo.regularHours;
            document.getElementById('summaryOTHours').textContent = supervisorInfo.otHours;
        }
        
        // Function to handle adding/editing an entry
        function handleAddEntry() {
            // Validate required fields
            if (!validateForm()) return;
            
            const entry = {
                workType: workTypeSelect.value,
                workArea: workAreaInput.value,
                length: parseFloat(lengthInput.value),
                width: parseFloat(widthInput.value),
                height: parseFloat(heightInput.value),
                cubicMeters: parseFloat(cubicMetersInput.value),
                quantity: parseInt(quantityInput.value) || 1,
                notes: workNotesInput.value
            };
            
            if (currentEditIndex >= 0) {
                // Update existing entry
                workEntries[currentEditIndex] = entry;
                currentEditIndex = -1;
                addEntryBtn.textContent = 'Add Entry';
            } else {
                // Add new entry
                workEntries.push(entry);
            }
            
            // Update UI
            renderEntries();
            updateSummary();
            resetForm();
        }
        
        // Function to validate form
        function validateForm() {
            let isValid = true;
            const requiredFields = [
                { field: workTypeSelect, name: 'Work Type' },
                { field: workAreaInput, name: 'Area/Zone' },
                { field: lengthInput, name: 'Length' },
                { field: widthInput, name: 'Width' },
                { field: heightInput, name: 'Height' }
            ];
            
            for (const item of requiredFields) {
                if (!item.field.value) {
                    alert(`Please enter ${item.name}`);
                    item.field.focus();
                    isValid = false;
                    break;
                }
            }
            
            return isValid;
        }
        
        // Function to render entries in the table
        function renderEntries() {
            if (workEntries.length === 0) {
                entriesTableBody.innerHTML = `
                    <tr class="text-center text-sm text-gray-500">
                        <td colspan="6" class="px-2 py-3">No entries added yet</td>
                    </tr>
                `;
                return;
            }
            
            entriesTableBody.innerHTML = workEntries.map((entry, index) => `
                <tr class="hover:bg-gray-50">
                    <td class="px-2 py-2 text-xs text-gray-900">${entry.workType.substring(0, 3)}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">${entry.workArea}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">${entry.length}×${entry.width}×${entry.height}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">${entry.cubicMeters.toFixed(2)}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">${entry.quantity}</td>
                    <td class="px-2 py-2 text-xs text-gray-900">
                        <div class="flex space-x-1">
                            <button class="text-blue-600 hover:text-blue-800" onclick="editEntry(${index})">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </button>
                            <button class="text-red-600 hover:text-red-800" onclick="deleteEntry(${index})">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Function to calculate effective cubic meters for productivity
        function calculateEffectiveCubicMeters() {
            let totalEffectiveCubicMeters = 0;
            
            workEntries.forEach(entry => {
                const cubicMeters = entry.cubicMeters * entry.quantity;
                
                // For dismantling, divide cubic meters by 2 for productivity calculation
                if (entry.workType === 'Dismantling') {
                    totalEffectiveCubicMeters += cubicMeters / 2;
                } else {
                    totalEffectiveCubicMeters += cubicMeters;
                }
            });
            
            return totalEffectiveCubicMeters;
        }
        
        // Function to update summary statistics
        function updateSummary() {
            const totalCubicMeters = workEntries.reduce((sum, entry) => sum + (entry.cubicMeters * entry.quantity), 0);
            const totalManHours = supervisorInfo.regularHours + supervisorInfo.otHours;
            const effectiveCubicMeters = calculateEffectiveCubicMeters();
            
            // Calculate productivity (cubic meters per hour)
            let productivity = 0;
            if (totalManHours > 0) {
                productivity = effectiveCubicMeters / totalManHours;
            }
            
            // Update summary dashboard
            document.getElementById('totalCubicMeters').textContent = totalCubicMeters.toFixed(2);
            document.getElementById('totalProductivity').textContent = productivity.toFixed(2);
        }
        
        // Function to reset form
        function resetForm() {
            workTypeSelect.value = '';
            workAreaInput.value = '';
            lengthInput.value = '';
            widthInput.value = '';
            heightInput.value = '';
            cubicMetersInput.value = '';
            quantityInput.value = '1';
            workNotesInput.value = '';
        }
        
        // Function to edit an entry
        window.editEntry = function(index) {
            const entry = workEntries[index];
            
            // Populate form with entry data
            workTypeSelect.value = entry.workType;
            workAreaInput.value = entry.workArea;
            lengthInput.value = entry.length;
            widthInput.value = entry.width;
            heightInput.value = entry.height;
            cubicMetersInput.value = entry.cubicMeters.toFixed(2);
            quantityInput.value = entry.quantity;
            workNotesInput.value = entry.notes || '';
            
            // Update button text and set edit index
            addEntryBtn.textContent = 'Update Entry';
            currentEditIndex = index;
        };
        
        // Function to delete an entry
        window.deleteEntry = function(index) {
            showConfirmationModal(
                'Are you sure you want to delete this entry?',
                () => {
                    workEntries.splice(index, 1);
                    renderEntries();
                    updateSummary();
                    
                    // If currently editing this entry, reset the form
                    if (currentEditIndex === index) {
                        resetForm();
                        addEntryBtn.textContent = 'Add Entry';
                        currentEditIndex = -1;
                    }
                }
            );
        };
        
        // Function to show confirmation modal
        function showConfirmationModal(message, onConfirm) {
            confirmationMessage.textContent = message;
            confirmationModal.classList.remove('hidden');
            
            // Set up confirm action
            confirmActionBtn.onclick = () => {
                onConfirm();
                confirmationModal.classList.add('hidden');
            };
        }
        
        // Function to show thank you modal based on productivity
        function showThankYouModal(productivity) {
            // Hide both cards initially
            highProductivityCard.classList.add('hidden');
            lowProductivityCard.classList.add('hidden');
            
            // Show appropriate card based on productivity
            if (productivity >= 2.5) {
                highProductivityCard.classList.remove('hidden');
            } else {
                lowProductivityCard.classList.remove('hidden');
            }
            
            // Show the modal
            thankYouModal.classList.remove('hidden');
        }
        
        // Function to prepare report preview
        function prepareReportPreview() {
            const reportPreview = document.getElementById('reportPreview');
            const previewSupervisor = document.getElementById('previewSupervisor');
            const previewPlant = document.getElementById('previewPlant');
            const previewManpower = document.getElementById('previewManpower');
            const previewRegularHours = document.getElementById('previewRegularHours');
            const previewOTHours = document.getElementById('previewOTHours');
            const reportDate = document.getElementById('reportDate');
            const previewTableBody = document.getElementById('previewTableBody');
            const previewTotalCubicMeters = document.getElementById('previewTotalCubicMeters');
            const previewTotalManHours = document.getElementById('previewTotalManHours');
            const previewProductivity = document.getElementById('previewProductivity');
            const previewGeneratedDate = document.getElementById('previewGeneratedDate');
            
            // Set supervisor info
            previewSupervisor.textContent = supervisorInfo.name;
            previewPlant.textContent = supervisorInfo.plant;
            previewManpower.textContent = supervisorInfo.manpower;
            previewRegularHours.textContent = supervisorInfo.regularHours;
            previewOTHours.textContent = supervisorInfo.otHours;
            
            // Format date
            const formattedDate = new Date(supervisorInfo.date).toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            reportDate.textContent = formattedDate;
            
            // Generate table rows
            previewTableBody.innerHTML = workEntries.map((entry, index) => `
                <tr>
                    <td class="border border-gray-200 px-2 py-1 text-xs text-center">${index + 1}</td>
                    <td class="border border-gray-200 px-2 py-1 text-xs">${entry.workType}</td>
                    <td class="border border-gray-200 px-2 py-1 text-xs">${entry.workArea}</td>
                    <td class="border border-gray-200 px-2 py-1 text-xs">${entry.length}×${entry.width}×${entry.height}</td>
                    <td class="border border-gray-200 px-2 py-1 text-xs text-center">${entry.cubicMeters.toFixed(2)}</td>
                    <td class="border border-gray-200 px-2 py-1 text-xs text-center">${entry.quantity}</td>
                </tr>
            `).join('');
            
            // Calculate totals
            const totalCubicMeters = workEntries.reduce((sum, entry) => sum + (entry.cubicMeters * entry.quantity), 0);
            const totalManHours = supervisorInfo.regularHours + supervisorInfo.otHours;
            const effectiveCubicMeters = calculateEffectiveCubicMeters();
            
            let productivity = 0;
            if (totalManHours > 0) {
                productivity = effectiveCubicMeters / totalManHours;
            }
            
            // Set summary info
            previewTotalCubicMeters.textContent = totalCubicMeters.toFixed(2) + " m³";
            previewTotalManHours.textContent = totalManHours + " hrs";
            previewProductivity.textContent = productivity.toFixed(2) + " m³/hr";
            
            // Set generated date
            previewGeneratedDate.textContent = new Date().toLocaleString();
            
            return {
                element: reportPreview,
                productivity: productivity
            };
        }
        
        // Function to download report as JPEG
        function downloadReport() {
            if (workEntries.length === 0) {
                alert('Please add at least one entry before downloading the report.');
                return;
            }
            
            const reportData = prepareReportPreview();
            const reportPreview = reportData.element;
            const productivity = reportData.productivity;
            
            reportPreview.classList.remove('hidden');
            
            html2canvas(reportPreview, {
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                // Hide the preview again
                reportPreview.classList.add('hidden');
                
                // Create download link
                const link = document.createElement('a');
                link.download = `Scaffolding_Report_${supervisorInfo.plant}_${supervisorInfo.date}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                
                // Show thank you modal based on productivity
                showThankYouModal(productivity);
            });
        }
        
        // Initialize the page
        renderEntries();
        updateSummary();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963a6cdd947f2e8f',t:'MTc1MzI2NTgxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
