<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Work Progress Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-2 sm:p-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-4 sm:mb-8">
            <h1 class="text-2xl sm:text-4xl font-bold text-gray-800 mb-2">Scaffolding Work Progress Tracker</h1>
            <p class="text-sm sm:text-base text-gray-600">Online reporting system for supervisors - Track manpower, overtime, volume & productivity</p>
        </div>

        <!-- Supervisor Info Panel -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Supervisor Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Supervisor Name</label>
                    <input type="text" id="supervisorName" 
                           class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Enter your name">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Work Location</label>
                    <input type="text" id="workLocation" 
                           class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Enter work location">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Work Date</label>
                    <input type="date" id="workDate" 
                           class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- Summary Dashboard -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-6">
            <div class="bg-blue-50 p-3 sm:p-4 rounded-lg text-center shadow">
                <div class="text-xl sm:text-2xl font-bold text-blue-600" id="totalEntries">0</div>
                <div class="text-xs sm:text-sm text-blue-700">Total Entries</div>
            </div>
            <div class="bg-green-50 p-3 sm:p-4 rounded-lg text-center shadow">
                <div class="text-xl sm:text-2xl font-bold text-green-600" id="totalVolume">0.000</div>
                <div class="text-xs sm:text-sm text-green-700">Total Volume (m³)</div>
            </div>
            <div class="bg-purple-50 p-3 sm:p-4 rounded-lg text-center shadow">
                <div class="text-xl sm:text-2xl font-bold text-purple-600" id="totalWorkers">0</div>
                <div class="text-xs sm:text-sm text-purple-700">Total Workers</div>
            </div>
            <div class="bg-orange-50 p-3 sm:p-4 rounded-lg text-center shadow">
                <div class="text-xl sm:text-2xl font-bold text-orange-600" id="totalHours">0</div>
                <div class="text-xs sm:text-sm text-orange-700">Total Hours</div>
            </div>
        </div>

        <!-- Work Entry Form -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Work Entry Form</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                <!-- Left Column - Work Details -->
                <div class="space-y-3 sm:space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Work Type</label>
                        <select id="workType" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select work type</option>
                            <option value="Erection">Scaffolding Erection</option>
                            <option value="Dismantling">Scaffolding Dismantling</option>
                            <option value="Modification">Scaffolding Modification</option>
                            <option value="Inspection">Safety Inspection</option>
                            <option value="Maintenance">Maintenance</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Scaffold Type</label>
                        <select id="scaffoldType" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select scaffold type</option>
                            <option value="Tube and Coupler">Tube and Coupler</option>
                            <option value="Frame Scaffold">Frame Scaffold</option>
                            <option value="System Scaffold">System Scaffold</option>
                            <option value="Mobile Scaffold">Mobile Scaffold</option>
                            <option value="Suspended Scaffold">Suspended Scaffold</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Location Details</label>
                        <input type="text" id="locationDetails" 
                               class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Specific area or zone">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Dimensions (m)</label>
                        <div class="grid grid-cols-3 gap-2">
                            <div>
                                <input type="number" id="length" step="0.01" min="0"
                                       class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="Length">
                            </div>
                            <div>
                                <input type="number" id="width" step="0.01" min="0"
                                       class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="Width">
                            </div>
                            <div>
                                <input type="number" id="height" step="0.01" min="0"
                                       class="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       placeholder="Height">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column - Labor Details -->
                <div class="space-y-3 sm:space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Number of Workers</label>
                        <input type="number" id="numWorkers" min="1"
                               class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Number of workers">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Regular Hours</label>
                        <input type="number" id="regularHours" step="0.5" min="0"
                               class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Regular hours worked">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Overtime Hours</label>
                        <input type="number" id="overtimeHours" step="0.5" min="0"
                               class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Overtime hours worked">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Notes</label>
                        <textarea id="notes" rows="2"
                                  class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  placeholder="Additional notes or comments"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 sm:mt-6 flex justify-end">
                <button id="addEntryBtn" class="w-full sm:w-auto px-4 sm:px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">
                    Add Entry
                </button>
            </div>
        </div>

        <!-- Work Entries Table -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6 overflow-x-auto">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Work Entries</h2>
            
            <div class="overflow-x-auto -mx-4 sm:mx-0">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Work Type</th>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Scaffold Type</th>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volume (m³)</th>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Workers</th>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours</th>
                            <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="entriesTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Entries will be added here dynamically -->
                        <tr class="text-gray-500 text-center">
                            <td colspan="7" class="px-3 sm:px-6 py-3 sm:py-4">No entries yet. Add your first work entry above.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export Section -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Export Report</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4">
                <button id="exportExcelBtn" class="px-4 sm:px-6 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Export to Excel
                </button>
                <button id="emailReportBtn" class="px-4 sm:px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    Email Report
                </button>
                <button id="printReportBtn" class="px-4 sm:px-6 py-2 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                    </svg>
                    Print Report
                </button>
                <button id="clearAllBtn" class="px-4 sm:px-6 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Clear All Data
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-4 sm:p-6 max-w-md w-full mx-4">
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Confirm Action</h3>
            <p id="confirmationMessage" class="text-gray-600 mb-4 sm:mb-6">Are you sure you want to proceed with this action?</p>
            <div class="flex justify-end space-x-3 sm:space-x-4">
                <button id="cancelAction" class="px-3 sm:px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all">
                    Cancel
                </button>
                <button id="confirmAction" class="px-3 sm:px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div id="emailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-4 sm:p-6 max-w-lg w-full mx-4">
            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">Send Report by Email</h3>
            
            <div class="space-y-3 sm:space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">To Email Address</label>
                    <input type="email" id="toEmail" 
                           class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="recipient@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Subject</label>
                    <input type="text" id="emailSubject" 
                           class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           value="Daily Scaffolding Progress Report">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">Message</label>
                    <textarea id="emailMessage" rows="4"
                              class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">Dear Sir,

Please find attached today's daily progress report.

Regards,</textarea>
                </div>
                <div class="text-sm text-gray-500">
                    <p>Note: The Excel report will be automatically attached to this email.</p>
                </div>
            </div>
            
            <div class="mt-4 sm:mt-6 flex justify-end space-x-3 sm:space-x-4">
                <button id="cancelEmail" class="px-3 sm:px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all">
                    Cancel
                </button>
                <button id="sendEmail" class="px-3 sm:px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">
                    Prepare Email
                </button>
            </div>
        </div>
    </div>

    <!-- Print Template (hidden) -->
    <div id="printTemplate" class="hidden">
        <div id="printContent"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            document.getElementById('workDate').valueAsDate = new Date();
            
            // Initialize entries array from localStorage or empty array
            let entries = JSON.parse(localStorage.getItem('scaffoldingEntries')) || [];
            
            // Initialize action type for confirmation modal
            let currentAction = '';
            let entryToDelete = null;
            
            // Update the UI with stored entries
            updateEntriesTable();
            updateSummary();
            
            // Add Entry Button Click Handler
            document.getElementById('addEntryBtn').addEventListener('click', function() {
                addNewEntry();
            });
            
            // Export Excel Button Click Handler
            document.getElementById('exportExcelBtn').addEventListener('click', function() {
                exportToExcel();
            });
            
            // Email Report Button Click Handler
            document.getElementById('emailReportBtn').addEventListener('click', function() {
                if (entries.length === 0) {
                    alert('No data to email. Please add entries first.');
                    return;
                }
                document.getElementById('emailModal').classList.remove('hidden');
            });
            
            // Print Report Button Click Handler
            document.getElementById('printReportBtn').addEventListener('click', function() {
                printReport();
            });
            
            // Clear All Button Click Handler
            document.getElementById('clearAllBtn').addEventListener('click', function() {
                if (entries.length === 0) {
                    alert('No data to clear.');
                    return;
                }
                
                currentAction = 'clearAll';
                document.getElementById('confirmationMessage').textContent = 'Are you sure you want to clear all entries? This action cannot be undone.';
                document.getElementById('confirmationModal').classList.remove('hidden');
            });
            
            // Confirmation Modal Handlers
            document.getElementById('cancelAction').addEventListener('click', function() {
                document.getElementById('confirmationModal').classList.add('hidden');
            });
            
            document.getElementById('confirmAction').addEventListener('click', function() {
                if (currentAction === 'clearAll') {
                    entries = [];
                    localStorage.setItem('scaffoldingEntries', JSON.stringify(entries));
                    updateEntriesTable();
                    updateSummary();
                } else if (currentAction === 'deleteEntry' && entryToDelete !== null) {
                    entries.splice(entryToDelete, 1);
                    localStorage.setItem('scaffoldingEntries', JSON.stringify(entries));
                    updateEntriesTable();
                    updateSummary();
                }
                
                document.getElementById('confirmationModal').classList.add('hidden');
            });
            
            // Email Modal Handlers
            document.getElementById('cancelEmail').addEventListener('click', function() {
                document.getElementById('emailModal').classList.add('hidden');
            });
            
            document.getElementById('sendEmail').addEventListener('click', function() {
                const toEmail = document.getElementById('toEmail').value;
                const subject = document.getElementById('emailSubject').value;
                const message = document.getElementById('emailMessage').value;
                
                if (!toEmail) {
                    alert('Please enter a recipient email address.');
                    return;
                }
                
                // Generate Excel file
                const excelData = generateExcelData();
                const fileName = `scaffolding_report_${new Date().toISOString().split('T')[0]}.xlsx`;
                
                // Create a mailto link with the email details
                const mailtoLink = `mailto:${encodeURIComponent(toEmail)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(message)}`;
                
                // Open the email client
                window.location.href = mailtoLink;
                
                // Also trigger the Excel download
                exportToExcel();
                
                // Close the modal
                document.getElementById('emailModal').classList.add('hidden');
                
                // Show instructions
                setTimeout(() => {
                    alert('Your email client has been opened. Please attach the Excel file that was just downloaded to complete your email.');
                }, 1000);
            });
            
            // Function to add a new entry
            function addNewEntry() {
                // Get form values
                const workType = document.getElementById('workType').value;
                const scaffoldType = document.getElementById('scaffoldType').value;
                const locationDetails = document.getElementById('locationDetails').value;
                const length = parseFloat(document.getElementById('length').value) || 0;
                const width = parseFloat(document.getElementById('width').value) || 0;
                const height = parseFloat(document.getElementById('height').value) || 0;
                const numWorkers = parseInt(document.getElementById('numWorkers').value) || 0;
                const regularHours = parseFloat(document.getElementById('regularHours').value) || 0;
                const overtimeHours = parseFloat(document.getElementById('overtimeHours').value) || 0;
                const notes = document.getElementById('notes').value;
                const supervisorName = document.getElementById('supervisorName').value;
                const workLocation = document.getElementById('workLocation').value;
                const workDate = document.getElementById('workDate').value;
                
                // Validate required fields
                if (!workType || !scaffoldType || !locationDetails || length <= 0 || width <= 0 || height <= 0 || numWorkers <= 0 || (regularHours <= 0 && overtimeHours <= 0)) {
                    alert('Please fill in all required fields with valid values.');
                    return;
                }
                
                // Calculate volume
                const volume = length * width * height;
                const totalHours = regularHours + overtimeHours;
                
                // Create entry object
                const entry = {
                    workType,
                    scaffoldType,
                    locationDetails,
                    dimensions: { length, width, height },
                    volume: parseFloat(volume.toFixed(3)),
                    numWorkers,
                    regularHours,
                    overtimeHours,
                    totalHours,
                    notes,
                    supervisorName,
                    workLocation,
                    workDate,
                    timestamp: new Date().toISOString()
                };
                
                // Add to entries array
                entries.push(entry);
                
                // Save to localStorage
                localStorage.setItem('scaffoldingEntries', JSON.stringify(entries));
                
                // Update UI
                updateEntriesTable();
                updateSummary();
                
                // Clear form fields
                document.getElementById('workType').value = '';
                document.getElementById('scaffoldType').value = '';
                document.getElementById('locationDetails').value = '';
                document.getElementById('length').value = '';
                document.getElementById('width').value = '';
                document.getElementById('height').value = '';
                document.getElementById('numWorkers').value = '';
                document.getElementById('regularHours').value = '';
                document.getElementById('overtimeHours').value = '';
                document.getElementById('notes').value = '';
            }
            
            // Function to update the entries table
            function updateEntriesTable() {
                const tableBody = document.getElementById('entriesTableBody');
                
                // Clear existing rows
                tableBody.innerHTML = '';
                
                if (entries.length === 0) {
                    // Show empty state
                    const emptyRow = document.createElement('tr');
                    emptyRow.className = 'text-gray-500 text-center';
                    emptyRow.innerHTML = '<td colspan="7" class="px-3 sm:px-6 py-3 sm:py-4">No entries yet. Add your first work entry above.</td>';
                    tableBody.appendChild(emptyRow);
                    return;
                }
                
                // Add entries to table
                entries.forEach((entry, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    
                    row.innerHTML = `
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">${entry.workType}</td>
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">${entry.scaffoldType}</td>
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">${entry.locationDetails}</td>
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">${entry.volume.toFixed(3)}</td>
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">${entry.numWorkers}</td>
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">${entry.totalHours.toFixed(1)}</td>
                        <td class="px-3 sm:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                            <button class="text-red-600 hover:text-red-900 delete-btn" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        entryToDelete = index;
                        currentAction = 'deleteEntry';
                        document.getElementById('confirmationMessage').textContent = 'Are you sure you want to delete this entry?';
                        document.getElementById('confirmationModal').classList.remove('hidden');
                    });
                });
            }
            
            // Function to update summary statistics
            function updateSummary() {
                let totalVolume = 0;
                let totalWorkers = 0;
                let totalHours = 0;
                
                entries.forEach(entry => {
                    totalVolume += entry.volume;
                    totalWorkers += entry.numWorkers;
                    totalHours += entry.totalHours;
                });
                
                document.getElementById('totalEntries').textContent = entries.length;
                document.getElementById('totalVolume').textContent = totalVolume.toFixed(3);
                document.getElementById('totalWorkers').textContent = totalWorkers;
                document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            }
            
            // Function to generate Excel data
            function generateExcelData() {
                // Create workbook and worksheet
                const wb = XLSX.utils.book_new();
                
                // Create summary worksheet
                const summaryData = [
                    ['Scaffolding Work Progress Report'],
                    [],
                    ['Supervisor:', document.getElementById('supervisorName').value || 'Not Specified'],
                    ['Work Location:', document.getElementById('workLocation').value || 'Not Specified'],
                    ['Work Date:', document.getElementById('workDate').value || 'Not Specified'],
                    ['Report Generated:', new Date().toLocaleString()],
                    [],
                    ['Summary Statistics'],
                    ['Total Entries:', entries.length],
                    ['Total Volume (m³):', parseFloat(document.getElementById('totalVolume').textContent)],
                    ['Total Workers:', parseInt(document.getElementById('totalWorkers').textContent)],
                    ['Total Hours:', parseFloat(document.getElementById('totalHours').textContent)]
                ];
                
                const summaryWS = XLSX.utils.aoa_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, summaryWS, 'Summary');
                
                // Create entries worksheet
                const entriesHeader = [
                    'Work Date', 'Supervisor', 'Work Location', 'Work Type', 'Scaffold Type', 
                    'Location Details', 'Length (m)', 'Width (m)', 'Height (m)', 'Volume (m³)', 
                    'Workers', 'Regular Hours', 'Overtime Hours', 'Total Hours', 'Notes'
                ];
                
                const entriesData = entries.map(entry => [
                    entry.workDate,
                    entry.supervisorName,
                    entry.workLocation,
                    entry.workType,
                    entry.scaffoldType,
                    entry.locationDetails,
                    entry.dimensions.length,
                    entry.dimensions.width,
                    entry.dimensions.height,
                    entry.volume,
                    entry.numWorkers,
                    entry.regularHours,
                    entry.overtimeHours,
                    entry.totalHours,
                    entry.notes
                ]);
                
                entriesData.unshift(entriesHeader);
                const entriesWS = XLSX.utils.aoa_to_sheet(entriesData);
                XLSX.utils.book_append_sheet(wb, entriesWS, 'Work Entries');
                
                return wb;
            }
            
            // Function to export data to Excel
            function exportToExcel() {
                if (entries.length === 0) {
                    alert('No data to export.');
                    return;
                }
                
                const wb = generateExcelData();
                const fileName = `scaffolding_report_${new Date().toISOString().split('T')[0]}.xlsx`;
                
                // Export to file
                XLSX.writeFile(wb, fileName);
            }
            
            // Function to print report
            function printReport() {
                if (entries.length === 0) {
                    alert('No data to print.');
                    return;
                }
                
                const printContent = document.getElementById('printContent');
                const supervisorName = document.getElementById('supervisorName').value || 'Not Specified';
                const workLocation = document.getElementById('workLocation').value || 'Not Specified';
                const workDate = document.getElementById('workDate').value || 'Not Specified';
                
                // Create print content
                let html = `
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #1e40af; text-align: center; }
                        h2 { color: #1e40af; margin-top: 20px; }
                        .info-section { margin-bottom: 20px; }
                        .info-item { margin-bottom: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .summary-box { display: inline-block; width: 23%; margin-right: 1%; padding: 10px; border: 1px solid #ddd; text-align: center; }
                        .summary-value { font-size: 24px; font-weight: bold; color: #1e40af; }
                        .summary-label { font-size: 14px; color: #666; }
                        @media print {
                            body { margin: 0; }
                            button { display: none; }
                        }
                    </style>
                    <h1>Scaffolding Work Progress Report</h1>
                    
                    <div class="info-section">
                        <div class="info-item"><strong>Supervisor:</strong> ${supervisorName}</div>
                        <div class="info-item"><strong>Work Location:</strong> ${workLocation}</div>
                        <div class="info-item"><strong>Work Date:</strong> ${workDate}</div>
                        <div class="info-item"><strong>Report Generated:</strong> ${new Date().toLocaleString()}</div>
                    </div>
                    
                    <h2>Summary</h2>
                    <div>
                        <div class="summary-box">
                            <div class="summary-value">${entries.length}</div>
                            <div class="summary-label">Total Entries</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-value">${parseFloat(document.getElementById('totalVolume').textContent).toFixed(3)}</div>
                            <div class="summary-label">Total Volume (m³)</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-value">${document.getElementById('totalWorkers').textContent}</div>
                            <div class="summary-label">Total Workers</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-value">${parseFloat(document.getElementById('totalHours').textContent).toFixed(1)}</div>
                            <div class="summary-label">Total Hours</div>
                        </div>
                    </div>
                    
                    <h2>Work Entries</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Work Type</th>
                                <th>Scaffold Type</th>
                                <th>Location</th>
                                <th>Volume (m³)</th>
                                <th>Workers</th>
                                <th>Regular Hours</th>
                                <th>Overtime Hours</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                entries.forEach(entry => {
                    html += `
                        <tr>
                            <td>${entry.workType}</td>
                            <td>${entry.scaffoldType}</td>
                            <td>${entry.locationDetails}</td>
                            <td>${entry.volume.toFixed(3)}</td>
                            <td>${entry.numWorkers}</td>
                            <td>${entry.regularHours.toFixed(1)}</td>
                            <td>${entry.overtimeHours.toFixed(1)}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                // Set print content
                printContent.innerHTML = html;
                
                // Open print dialog
                const printWindow = window.open('', '_blank');
                printWindow.document.write(html);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9639875f80947f8d',t:'MTc1MzI1NjQxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
