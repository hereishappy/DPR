<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Data Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%); }
        .btn-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .btn-secondary:hover { background: linear-gradient(135deg, #e879f9 0%, #ef4444 100%); }
        .btn-success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .btn-success:hover { background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Scaffolding Data Collection</h1>
            <p class="text-gray-600 text-sm">Mobile Interface for Supervisors</p>
        </div>

        <!-- Card 1: Basic Information -->
        <div id="card1" class="bg-white rounded-xl card-shadow p-6 mb-4">
            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-2">1</span>
                Basic Information
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Supervisor Name</label>
                    <input type="text" id="supervisorName" placeholder="Enter supervisor name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Area</label>
                    <input type="text" id="area" placeholder="Enter work area" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Manpower</label>
                        <input type="number" id="manpower" placeholder="0" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Overtime Hours</label>
                        <input type="number" id="overtime" placeholder="0" min="0" step="0.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-3">
                    <p class="text-sm text-gray-600 mb-1">Work Summary:</p>
                    <p id="workSummary" class="text-sm font-medium text-gray-800">0 men × 8 + 0 overtime</p>
                </div>
            </div>
            
            <button onclick="submitCard1()" class="w-full mt-6 btn-primary text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                Continue to Work Details
            </button>
        </div>

        <!-- Card 2: Work Details -->
        <div id="card2" class="bg-white rounded-xl card-shadow p-6 mb-4 hidden">
            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-2">2</span>
                Work Details
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Work Type</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="setWorkType('erection')" id="erectionBtn" class="py-2 px-4 border-2 border-green-500 text-green-500 rounded-lg font-medium transition-all duration-200 hover:bg-green-500 hover:text-white">
                            Erection
                        </button>
                        <button onclick="setWorkType('dismantling')" id="dismantlingBtn" class="py-2 px-4 border-2 border-red-500 text-red-500 rounded-lg font-medium transition-all duration-200 hover:bg-red-500 hover:text-white">
                            Dismantling
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Length (m)</label>
                        <input type="number" id="length" placeholder="0" min="0" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Width (m)</label>
                        <input type="number" id="width" placeholder="0" min="0" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Height (m)</label>
                        <input type="number" id="height" placeholder="0" min="0" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                    <input type="number" id="quantity" placeholder="1" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="bg-gray-50 rounded-lg p-3">
                    <p class="text-sm text-gray-600 mb-1">Calculated Volume:</p>
                    <p id="calculatedVolume" class="text-sm font-medium text-gray-800">0.00 m³</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Remarks</label>
                    <textarea id="remarks" placeholder="Add any remarks or notes..." rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex gap-2 mt-6">
                <button onclick="addEntry()" class="flex-1 btn-success text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                    Add Entry
                </button>
                <button onclick="showReport()" class="flex-1 btn-secondary text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                    Generate Report
                </button>
            </div>
            
            <!-- Entries List -->
            <div id="entriesList" class="mt-6 space-y-2"></div>
        </div>

        <!-- Card 3: Report -->
        <div id="card3" class="bg-white rounded-xl card-shadow p-6 mb-4 hidden">
            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm mr-2">3</span>
                Work Report
            </h2>
            
            <div id="reportContent" class="space-y-4">
                <!-- Report content will be generated here -->
            </div>
            
            <div class="flex gap-2 mt-6">
                <button onclick="downloadReport()" class="flex-1 btn-primary text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                    Download Report
                </button>
                <button onclick="resetApp()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200">
                    New Report
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentWorkType = '';
        let entries = [];
        let basicInfo = {};

        // Set today's date by default
        document.getElementById('date').valueAsDate = new Date();

        // Update work summary when manpower or overtime changes
        document.getElementById('manpower').addEventListener('input', updateWorkSummary);
        document.getElementById('overtime').addEventListener('input', updateWorkSummary);

        // Update calculated volume when dimensions change
        document.getElementById('length').addEventListener('input', updateCalculatedVolume);
        document.getElementById('width').addEventListener('input', updateCalculatedVolume);
        document.getElementById('height').addEventListener('input', updateCalculatedVolume);
        document.getElementById('quantity').addEventListener('input', updateCalculatedVolume);

        function updateWorkSummary() {
            const manpower = parseInt(document.getElementById('manpower').value) || 0;
            const overtime = parseFloat(document.getElementById('overtime').value) || 0;
            document.getElementById('workSummary').textContent = `${manpower} men × 8 + ${overtime} overtime`;
        }

        function updateCalculatedVolume() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            
            const volume = length * width * height * quantity;
            document.getElementById('calculatedVolume').textContent = `${volume.toFixed(2)} m³`;
        }

        function submitCard1() {
            const date = document.getElementById('date').value;
            const supervisorName = document.getElementById('supervisorName').value;
            const area = document.getElementById('area').value;
            const manpower = parseInt(document.getElementById('manpower').value) || 0;
            const overtime = parseFloat(document.getElementById('overtime').value) || 0;

            if (!date || !supervisorName || !area || manpower <= 0) {
                alert('Please fill in all required fields');
                return;
            }

            basicInfo = { date, supervisorName, area, manpower, overtime };
            
            document.getElementById('card1').classList.add('hidden');
            document.getElementById('card2').classList.remove('hidden');
        }

        function setWorkType(type) {
            currentWorkType = type;
            
            // Reset button styles
            document.getElementById('erectionBtn').className = 'py-2 px-4 border-2 border-green-500 text-green-500 rounded-lg font-medium transition-all duration-200 hover:bg-green-500 hover:text-white';
            document.getElementById('dismantlingBtn').className = 'py-2 px-4 border-2 border-red-500 text-red-500 rounded-lg font-medium transition-all duration-200 hover:bg-red-500 hover:text-white';
            
            // Highlight selected button
            if (type === 'erection') {
                document.getElementById('erectionBtn').className = 'py-2 px-4 bg-green-500 text-white rounded-lg font-medium';
            } else {
                document.getElementById('dismantlingBtn').className = 'py-2 px-4 bg-red-500 text-white rounded-lg font-medium';
            }
        }

        function addEntry() {
            if (!currentWorkType) {
                alert('Please select work type (Erection or Dismantling)');
                return;
            }

            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;

            if (length <= 0 || width <= 0 || height <= 0) {
                alert('Please enter valid dimensions');
                return;
            }

            const volume = length * width * height * quantity;
            const entry = {
                type: currentWorkType,
                length,
                width,
                height,
                quantity,
                volume
            };

            entries.push(entry);
            updateEntriesList();
            clearEntryForm();
        }

        function updateEntriesList() {
            const entriesList = document.getElementById('entriesList');
            entriesList.innerHTML = '';

            if (entries.length === 0) return;

            const title = document.createElement('h3');
            title.className = 'text-md font-medium text-gray-800 mb-2';
            title.textContent = 'Added Entries:';
            entriesList.appendChild(title);

            entries.forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = `bg-${entry.type === 'erection' ? 'green' : 'red'}-50 border border-${entry.type === 'erection' ? 'green' : 'red'}-200 rounded-lg p-3 flex justify-between items-center`;
                
                entryDiv.innerHTML = `
                    <div>
                        <p class="text-sm font-medium text-gray-800">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}</p>
                        <p class="text-xs text-gray-600">${entry.length}×${entry.width}×${entry.height} × ${entry.quantity} = ${entry.volume.toFixed(2)} m³</p>
                    </div>
                    <button onclick="removeEntry(${index})" class="text-red-500 hover:text-red-700 text-sm font-medium">Remove</button>
                `;
                
                entriesList.appendChild(entryDiv);
            });
        }

        function removeEntry(index) {
            entries.splice(index, 1);
            updateEntriesList();
        }

        function clearEntryForm() {
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('calculatedVolume').textContent = '0.00 m³';
            currentWorkType = '';
            
            // Reset button styles
            document.getElementById('erectionBtn').className = 'py-2 px-4 border-2 border-green-500 text-green-500 rounded-lg font-medium transition-all duration-200 hover:bg-green-500 hover:text-white';
            document.getElementById('dismantlingBtn').className = 'py-2 px-4 border-2 border-red-500 text-red-500 rounded-lg font-medium transition-all duration-200 hover:bg-red-500 hover:text-white';
        }

        function showReport() {
            if (entries.length === 0) {
                alert('Please add at least one entry before generating report');
                return;
            }

            const totalErection = entries.filter(e => e.type === 'erection').reduce((sum, e) => sum + e.volume, 0);
            const totalDismantling = entries.filter(e => e.type === 'dismantling').reduce((sum, e) => sum + e.volume, 0);
            const totalManhours = (basicInfo.manpower * 8) + basicInfo.overtime;
            const productivity = totalManhours > 0 ? (totalErection + (totalDismantling / 2)) / totalManhours : 0;

            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div class="bg-blue-50 rounded-lg p-4 mb-4">
                    <h3 class="font-semibold text-gray-800 mb-2">Supervisor Information</h3>
                    <p class="text-sm text-gray-600"><strong>Name:</strong> ${basicInfo.supervisorName}</p>
                    <p class="text-sm text-gray-600"><strong>Date:</strong> ${basicInfo.date}</p>
                    <p class="text-sm text-gray-600"><strong>Area:</strong> ${basicInfo.area}</p>
                    <p class="text-sm text-gray-600"><strong>Manpower:</strong> ${basicInfo.manpower} men × 8 + ${basicInfo.overtime} overtime = ${totalManhours} hours</p>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-green-50 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-600 mb-1">Total Erection</p>
                        <p class="text-lg font-bold text-green-600">${totalErection.toFixed(2)} m³</p>
                    </div>
                    <div class="bg-red-50 rounded-lg p-3 text-center">
                        <p class="text-xs text-gray-600 mb-1">Total Dismantling</p>
                        <p class="text-lg font-bold text-red-600">${totalDismantling.toFixed(2)} m³</p>
                    </div>
                </div>

                <div class="bg-purple-50 rounded-lg p-4 text-center mb-4">
                    <p class="text-sm text-gray-600 mb-1">Productivity</p>
                    <p class="text-xl font-bold text-purple-600">${productivity.toFixed(3)} m³/hour</p>
                    <p class="text-xs text-gray-500 mt-1">Formula: (Erection + Dismantling/2) / Total Manhours</p>
                </div>

                ${productivity >= 2.5 ? `
                <div class="bg-gradient-to-r from-green-400 to-blue-500 rounded-lg p-4 text-center mb-4 text-white">
                    <div class="text-2xl mb-2">🎉 ⭐ 🏆</div>
                    <p class="font-bold text-lg">Excellent Work!</p>
                    <p class="text-sm">Thank you for your outstanding efforts!</p>
                    <p class="text-xs mt-1 opacity-90">आपके उत्कृष्ट प्रयासों के लिए धन्यवाद!</p>
                </div>
                ` : `
                <div class="bg-gradient-to-r from-red-400 to-pink-500 rounded-lg p-4 text-center mb-4 text-white">
                    <div class="text-2xl mb-2">😔 📉 ⚠️</div>
                    <p class="font-bold text-lg">Needs Improvement</p>
                    <p class="text-sm">This is not what we are expecting from you.</p>
                    <p class="text-xs mt-1 opacity-90">यह वह नहीं है जिसकी हम आपसे अपेक्षा कर रहे हैं।</p>
                </div>
                `}

                ${document.getElementById('remarks').value ? `
                <div class="bg-yellow-50 rounded-lg p-4 mb-4">
                    <h4 class="font-medium text-gray-800 mb-2">Remarks:</h4>
                    <p class="text-sm text-gray-700">${document.getElementById('remarks').value}</p>
                </div>
                ` : ''}

                <div class="space-y-2">
                    <h4 class="font-medium text-gray-800">Work Details:</h4>
                    ${entries.map(entry => `
                        <div class="bg-gray-50 rounded p-2 text-sm">
                            <span class="font-medium ${entry.type === 'erection' ? 'text-green-600' : 'text-red-600'}">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}:</span>
                            ${entry.length}×${entry.width}×${entry.height} × ${entry.quantity} = ${entry.volume.toFixed(2)} m³
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('card2').classList.add('hidden');
            document.getElementById('card3').classList.remove('hidden');
        }

        function downloadReport() {
            const totalErection = entries.filter(e => e.type === 'erection').reduce((sum, e) => sum + e.volume, 0);
            const totalDismantling = entries.filter(e => e.type === 'dismantling').reduce((sum, e) => sum + e.volume, 0);
            const totalManhours = (basicInfo.manpower * 8) + basicInfo.overtime;
            const productivity = totalManhours > 0 ? (totalErection + (totalDismantling / 2)) / totalManhours : 0;
            const remarks = document.getElementById('remarks').value;

            // Create a canvas to generate the ID card sized JPEG report
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size for ID card (2 inch width x 3 inch height at 300 DPI)
            canvas.width = 600;  // 2 inches * 300 DPI
            canvas.height = 900; // 3 inches * 300 DPI
            
            // Set background with gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#f8fafc');
            gradient.addColorStop(1, '#e2e8f0');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add border
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 4;
            ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
            
            let y = 50;
            
            // Title
            ctx.fillStyle = '#1e40af';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('SCAFFOLDING REPORT', canvas.width / 2, y);
            y += 35;
            
            // Basic Info
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#374151';
            ctx.fillText(`Supervisor: ${basicInfo.supervisorName}`, 25, y);
            y += 20;
            ctx.fillText(`Date: ${basicInfo.date}`, 25, y);
            y += 20;
            ctx.fillText(`Area: ${basicInfo.area}`, 25, y);
            y += 20;
            ctx.fillText(`Manpower: ${basicInfo.manpower} × 8 + ${basicInfo.overtime}OT`, 25, y);
            y += 30;
            
            // Summary boxes
            ctx.fillStyle = '#dcfce7';
            ctx.fillRect(25, y, 250, 35);
            ctx.strokeStyle = '#16a34a';
            ctx.lineWidth = 1;
            ctx.strokeRect(25, y, 250, 35);
            ctx.fillStyle = '#16a34a';
            ctx.font = 'bold 10px Arial';
            ctx.fillText('ERECTION', 30, y + 15);
            ctx.font = 'bold 14px Arial';
            ctx.fillText(`${totalErection.toFixed(1)} m³`, 30, y + 30);
            
            y += 45;
            ctx.fillStyle = '#fecaca';
            ctx.fillRect(25, y, 250, 35);
            ctx.strokeStyle = '#dc2626';
            ctx.strokeRect(25, y, 250, 35);
            ctx.fillStyle = '#dc2626';
            ctx.font = 'bold 10px Arial';
            ctx.fillText('DISMANTLING', 30, y + 15);
            ctx.font = 'bold 14px Arial';
            ctx.fillText(`${totalDismantling.toFixed(1)} m³`, 30, y + 30);
            
            y += 45;
            ctx.fillStyle = '#e0e7ff';
            ctx.fillRect(25, y, 250, 35);
            ctx.strokeStyle = '#6366f1';
            ctx.strokeRect(25, y, 250, 35);
            ctx.fillStyle = '#6366f1';
            ctx.font = 'bold 10px Arial';
            ctx.fillText('PRODUCTIVITY', 30, y + 15);
            ctx.font = 'bold 14px Arial';
            ctx.fillText(`${productivity.toFixed(2)} m³/hr`, 30, y + 30);
            
            y += 55;
            
            // Productivity feedback
            if (productivity >= 2.5) {
                ctx.fillStyle = '#dcfce7';
                ctx.fillRect(25, y, 250, 60);
                ctx.strokeStyle = '#16a34a';
                ctx.strokeRect(25, y, 250, 60);
                ctx.fillStyle = '#16a34a';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('🎉 EXCELLENT!', canvas.width / 2, y + 20);
                ctx.font = '9px Arial';
                ctx.fillText('Thank you for outstanding efforts!', canvas.width / 2, y + 35);
                ctx.fillText('उत्कृष्ट प्रयासों के लिए धन्यवाद!', canvas.width / 2, y + 50);
            } else {
                ctx.fillStyle = '#fecaca';
                ctx.fillRect(25, y, 250, 60);
                ctx.strokeStyle = '#dc2626';
                ctx.strokeRect(25, y, 250, 60);
                ctx.fillStyle = '#dc2626';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('😔 NEEDS IMPROVEMENT', canvas.width / 2, y + 20);
                ctx.font = '8px Arial';
                ctx.fillText('Not what we expect from you', canvas.width / 2, y + 35);
                ctx.fillText('यह हमारी अपेक्षा नहीं है', canvas.width / 2, y + 50);
            }
            
            y += 80;
            
            // Remarks (if any)
            if (remarks && remarks.trim()) {
                ctx.fillStyle = '#fef3c7';
                ctx.fillRect(25, y, 250, 60);
                ctx.strokeStyle = '#f59e0b';
                ctx.strokeRect(25, y, 250, 60);
                ctx.fillStyle = '#92400e';
                ctx.font = 'bold 9px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('REMARKS:', 30, y + 15);
                ctx.font = '8px Arial';
                
                // Word wrap for remarks in small space
                const words = remarks.split(' ');
                let line = '';
                let lineY = y + 30;
                for (let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + ' ';
                    const metrics = ctx.measureText(testLine);
                    if (metrics.width > 240 && n > 0) {
                        ctx.fillText(line, 30, lineY);
                        line = words[n] + ' ';
                        lineY += 12;
                        if (lineY > y + 55) break; // Stop if no more space
                    } else {
                        line = testLine;
                    }
                }
                if (lineY <= y + 55) ctx.fillText(line, 30, lineY);
                y += 70;
            }
            
            // Work entries summary (compact)
            if (entries.length > 0 && y < canvas.height - 100) {
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 9px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('WORK ENTRIES:', 25, y);
                y += 15;
                
                ctx.font = '7px Arial';
                entries.slice(0, 8).forEach((entry, index) => { // Show max 8 entries
                    const color = entry.type === 'erection' ? '#16a34a' : '#dc2626';
                    ctx.fillStyle = color;
                    const text = `${index + 1}. ${entry.type.charAt(0).toUpperCase()}${entry.type.slice(1)}: ${entry.volume.toFixed(1)}m³`;
                    ctx.fillText(text, 25, y);
                    y += 12;
                    if (y > canvas.height - 50) break;
                });
                
                if (entries.length > 8) {
                    ctx.fillStyle = '#6b7280';
                    ctx.fillText(`... and ${entries.length - 8} more entries`, 25, y);
                }
            }
            
            // Footer
            ctx.fillStyle = '#6b7280';
            ctx.font = '7px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`Generated: ${new Date().toLocaleString()}`, canvas.width / 2, canvas.height - 20);
            
            // Convert canvas to JPEG and download
            canvas.toBlob(function(blob) {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Scaffolding_IDCard_${basicInfo.supervisorName}_${basicInfo.date}.jpg`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 'image/jpeg', 0.95);
        }

        function resetApp() {
            entries = [];
            basicInfo = {};
            currentWorkType = '';
            
            // Reset all forms
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('supervisorName').value = '';
            document.getElementById('area').value = '';
            document.getElementById('manpower').value = '';
            document.getElementById('overtime').value = '';
            document.getElementById('remarks').value = '';
            updateWorkSummary();
            clearEntryForm();
            
            // Show first card
            document.getElementById('card1').classList.remove('hidden');
            document.getElementById('card2').classList.add('hidden');
            document.getElementById('card3').classList.add('hidden');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'963c47e4379e493c',t:'MTc1MzI4NTI3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
